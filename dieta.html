<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="mobile-web-app-capable"/>
<title>ğŸ Dieta personalizada | MFIT Premium</title>
<style>
    :root{
      --green:#00CC66;
      --bg:#0a0a0a;
      --panel:#111;
      --muted:#9a9a9a;
      --danger:#ff4d4d;
      --border:#1e1e1e;
      --panel-alt:#0e0e0e;
      --text:#eaeaea;
    }

    html,body{
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
    }

    .wrap{
      max-width:820px;
      margin:0 auto;
      padding:16px;
    }

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow:0 8px 28px rgba(0,0,0,.35);
    }

    .logo{
      display:flex;
      align-items:center;
      justify-content:center;
      margin:8px 0 16px;
    }

    .logo img{max-width:240px;height:auto;filter:drop-shadow(0 6px 18px rgba(0,204,102,.25));}

    h1{
      margin:8px 0 8px;
      font-size:1.35rem;
      color:var(--green);
      text-align:center;
      letter-spacing:.5px
    }

    .subtitle{
      margin:0 0 10px;
      text-align:center;
      color:#c9c9c9;
      font-size:.95rem
    }

    .section{
      margin:18px 0;
      padding:14px;
      border:1px solid #1f1f1f;
      border-radius:14px;
      background:var(--panel-alt);
    }

    .section-title{
      margin:0 0 6px;
      color:#fff;
      font-weight:700;
      font-size:1rem;
      background:linear-gradient(90deg, rgba(41,255,71,.15), transparent);
      padding:8px 10px;
      border-radius:10px
    }

    label.q{
      display:block;
      color:#fff;
      font-weight:600;
      margin:12px 0 6px
    }

    .hint{
      color:var(--muted);
      font-size:.88rem;
      margin:-2px 0 8px
    }

    input[type=text],
    input[type=number],
    textarea,
    select{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#141414;
      color:#eee;
      outline:none;
      transition:.2s;
      font-size:.95rem;
    }
    textarea{min-height:84px;resize:vertical}

    input:focus,
    textarea:focus,
    select:focus{
      border-color:var(--green);
      box-shadow:0 0 0 3px rgba(41,255,71,.12)
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px
    }

    @media (max-width:560px){
      .row{grid-template-columns:1fr}
      .logo img{max-width:240px;height:auto;filter:drop-shadow(0 6px 18px rgba(0,204,102,.25));}
    }

    /* BOTÃ•ES FINAIS */
    .btns{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:18px;
    }
    @media (min-width:520px){
      .btns{grid-template-columns:1fr 1fr;}
    }

    .btn{
      width:100%;
      background:var(--green);
      color:#091109;
      border:none;
      border-radius:14px;
      padding:14px 16px;
      font-weight:800;
      font-size:1.05rem;
      box-shadow:0 10px 30px rgba(41,255,71,.22);
      cursor:pointer;
    }
    .btn:active{transform:translateY(1px)}

    .btn-outline{
      background:#171717;
      color:#eaeaea;
      border:1px solid #2a2a2a;
      box-shadow:none;
    }
    .btn-outline:active{transform:translateY(1px)}
.btn.small{width:auto;padding:10px 12px;font-size:.95rem;border-radius:12px}


    .error{
      color:var(--danger);
      font-size:.9rem;
      margin-top:6px;
      display:none
    }

    .success{
      display:none;
      color:#b6f5c1;
      background:#0f1f12;
      border:1px solid #203b21;
      padding:10px;
      border-radius:10px;
      margin-top:10px
    }

    /* ====== CARDS DE ALIMENTO (com emoji e seleÃ§Ã£o verde) ====== */
    .food-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(min(110px,31%),1fr));
      gap:12px;
    }

    .food-card{
      background:#141414;
      border:2px solid var(--border);
      border-radius:16px;
      padding:14px 10px;
      text-align:center;
      color:#fff;
      font-size:.85rem;
      line-height:1.3;
      font-weight:600;
      cursor:pointer;
      user-select:none;
      min-height:96px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      position:relative;
      box-shadow:0 12px 24px rgba(0,0,0,.6);
      transition:transform .06s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    }

    .food-card:active{
      transform:scale(.98)
    }

    .food-card .emoji{
      font-size:1.5rem;
      line-height:1.5rem;
      margin-bottom:6px;
    }

    .food-card .label{
      font-size:.8rem;
      color:#fff;
      word-break:break-word;
    }

    .food-card .check-badge{
      display:none;
      position:absolute;
      top:6px;
      right:6px;
      background-color:rgba(0,0,0,.8);
      color:var(--green);
      font-size:.9rem;
      line-height:1;
      padding:5px 7px;
      border-radius:8px;
      border:1px solid var(--green);
      font-weight:800;
      box-shadow:0 6px 14px rgba(41,255,71,.25);
    }

    .food-card.selected{
      background:var(--green);
      border-color:var(--green);
      color:#000;
      box-shadow:0 0 24px rgba(41,255,71,.45);
    }

    .food-card.selected .label{
      color:#000;
      font-weight:800;
    }

    .food-card.selected .check-badge{
      display:block;
    }

  
/* === MFIT: Guia Metabolismo Ã— Objetivo === */
#mfit-guide{background:#0f0f0f;border:1px solid #1e1e1e;border-radius:16px;padding:16px;margin:16px 0}
#mfit-guide h3{margin:0 0 8px;color:var(--green,#00CC66)}
#mfit-guide .row{display:grid;grid-template-columns:1fr;gap:12px}
#mfit-guide .pill{display:inline-block;padding:6px 10px;border:1px solid #2a2a2a;border-radius:999px;margin:2px 6px 2px 0}
#mfit-guide .list{margin:6px 0 0 0;padding-left:18px}
#mfit-guide .list li{margin:4px 0}
#mfit-guide .muted{color:#bdbdbd}


/* === MFIT: destaque de alimentos por regra === */
.food-card.recommended{outline:2px solid var(--green,#00CC66); box-shadow:0 0 16px rgba(0,204,102,.25)}
.food-card.dim{opacity:.38; filter:grayscale(1)}


/* === MFIT: seÃ§Ã£o final de alimentos sugeridos === */
#mfit-food-auto{background:#0f0f0f;border:1px solid #1e1e1e;border-radius:16px;padding:16px;margin:24px 0}
#mfit-food-auto h3{color:var(--green,#00CC66);margin:0 0 12px}
.mfit-chip{display:inline-flex;align-items:center;gap:8px;margin:6px 6px 0 0;padding:8px 12px;border:1px solid #2a2a2a;border-radius:999px;background:#111;color:#fff;cursor:pointer;user-select:none}
.mfit-chip input{accent-color:var(--green,#00CC66)}
.mfit-chip.limit{opacity:.65;filter:grayscale(1)}
.mfit-note{color:#bdbdbd;font-size:.95rem;margin-top:8px}


.hidden{display:none !important}

/* === MFIT: aviso quando o teste nÃ£o foi concluÃ­do === */
#mfit-locked-note{
  background:#121212;
  border:1px dashed #2a2a2a;
  border-radius:14px;
  padding:14px 16px;
  margin:16px 0;
  color:#cfcfcf;
}
#mfit-locked-note b{ color:var(--green,#00CC66); }
.hidden{ display:none !important; }


/* === MFIT v2.0: estado nÃ£o indicado (bloqueado) === */
.food-card.blocked{opacity:.35; filter:grayscale(1); pointer-events:none; position:relative}
.food-card.blocked::after{
  content:'NÃ£o indicado';
  position:absolute; inset:auto 8px 8px auto;
  font-size:.75rem; padding:2px 6px; border-radius:6px;
  background:#2a2a2a; color:#ccc; border:1px solid #3a3a3a;
}
/* MantÃ©m apenas DIM nos "limitar", mas permite clique */
.food-card.dim{opacity:.55; filter:grayscale(.6); pointer-events:auto}


/* === MFIT v2.1: neutraliza destaque 'recommended' e impede autoseleÃ§Ã£o visual === */
.food-card.recommended{outline:none; box-shadow:none}


/* === MFIT v2.2: aviso WhatsApp no rodapÃ© === */
#mfit-wa-note{
  display:none;
  background:rgba(0,204,102,.12);
  border:1px solid rgba(0,204,102,.4);
  color:#cfead9;
  padding:14px 16px;
  border-radius:14px;
  margin:12px 0 0 0;
  font-size:1rem;
}
#mfit-wa-note b{color:#00CC66}


/* === MFIT v2.4: layout final consistente === */
#mfit-food-auto{margin-top:24px}
.mfit-final-grid{display:grid;gap:12px}
@media(min-width:900px){ .mfit-final-grid{grid-template-columns:1fr 1fr 1fr} }
.mfit-panel{background:#0f0f0f;border:1px solid #1e1e1e;border-radius:14px;padding:12px}
.mfit-panel h4{margin:0 0 8px;color:var(--green,#00CC66)}
.mfit-chip{display:inline-flex;align-items:center;gap:8px;margin:6px 6px 0 0;padding:8px 12px;border:1px solid #2a2a2a;border-radius:999px;background:#111;color:#fff;cursor:pointer;user-select:none}
.mfit-chip input{accent-color:var(--green,#00CC66)}
.mfit-chip.block{opacity:.5;filter:grayscale(1);cursor:not-allowed}
.mfit-note{color:#bdbdbd;font-size:.95rem;margin-top:8px}



    /* === MFIT ULTIMATE: Modo Pro + Modo Lite + animaÃ§Ãµes seguras === */
    body.mfit-pro .food-card{
      transition:transform .12s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
    }
    body.mfit-pro .food-card:hover{
      transform:translateY(-2px) scale(1.01);
      box-shadow:0 16px 36px rgba(0,0,0,.75);
    }
    body.mfit-pro .btn{
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease;
    }
    body.mfit-pro .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 34px rgba(41,255,71,.32);
    }

    /* Lite: remove sombras e transiÃ§Ãµes para celulares fracos */
    body.mfit-lite .card,
    body.mfit-lite .section,
    body.mfit-lite .food-card,
    body.mfit-lite .btn{
      box-shadow:none !important;
      transition:none !important;
    }
    body.mfit-lite .food-card:hover,
    body.mfit-lite .btn:hover{
      transform:none !important;
    }

    /* Respeito a preferÃªncia de reduÃ§Ã£o de movimento do sistema */
    @media (prefers-reduced-motion: reduce){
      *{
        animation-duration:0.001ms !important;
        animation-iteration-count:1 !important;
        transition-duration:0.001ms !important;
        scroll-behavior:auto !important;
      }
    }

/* Biotipo visual (empilhado: imagem em cima, texto embaixo) */
.bio-grid{display:grid;gap:12px;margin-top:10px;}
.bio-card{
  position:relative;
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:12px;
  cursor:pointer;
  transition:transform .08s ease,border-color .12s ease, box-shadow .12s ease;
  outline:none;
}
.bio-card:hover{border-color:rgba(0,204,102,.45);}
.bio-card.selected{
  border-color:rgba(0,204,102,.9);
  box-shadow:0 0 0 2px rgba(0,204,102,.22) inset;
}
.bio-media{
  background:rgba(0,0,0,.28);
  border-radius:14px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  height:190px;
}
.bio-img, .bio-svg {
  width:100%;
  height:100%;
  object-fit:contain;
  object-position:center;
  display:block;
}
.bioSvg{width:100%;height:100%;display:block;}
.bio-body{padding:2px 2px 2px 2px;}
.bio-name{font-size:22px;font-weight:800;margin:2px 0 6px;}
.bio-desc{color:rgba(255,255,255,.78);line-height:1.35;margin:0 0 10px;}
.bio-bullets-title{font-weight:800;letter-spacing:.06em;color:rgba(255,255,255,.85);font-size:12px;margin:0 0 6px;}
.bio-bullets{margin:0;padding-left:18px;color:rgba(255,255,255,.82);line-height:1.35;}
.bio-bullets li{margin:4px 0;}
.bio-radio{
  position:absolute;
  top:14px;
  right:14px;
  width:26px;height:26px;border-radius:999px;
  border:2px solid rgba(255,255,255,.35);
  background:rgba(0,0,0,.25);
}
.bio-card.selected .bio-radio{border-color:rgba(0,204,102,1);}
.bio-card.selected .bio-radio:after{
  content:"";
  position:absolute; inset:6px;
  border-radius:999px;
  background:rgba(0,204,102,1);
}
@media (max-width: 820px){
  .bio-media{height:175px;}
  .bio-name{font-size:20px;}
}

.bio-media img{width:100%;height:100%;display:block;object-fit:contain;background:#fff;border-radius:18px}
</style>
</head>
<body data-mfit="1">
<div class="container" id="guiaMetaObjetivo"></div>
<div class="wrap">
<!-- LOGO / TÃTULO -->
<div class="logo">
<img alt="Logo MFIT" id="brandLogo" src="assets/logo.png"/>
</div>
<h1>ğŸ Dieta personalizada</h1>
<p class="subtitle">
      Responda para criarmos sua dieta personalizada conforme metabolismo, rotina e objetivo.
      Envio direto no WhatsApp do Personal.
    </p>
<form class="card" id="mfitDieta" onsubmit="return false;">
<!-- SeÃ§Ã£o 0 â€“ Dados do Aluno -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 0 â€“ Dados do Aluno</div>
<div class="row">
<div>
<label class="q" for="nomeAluno">Nome completo</label>
<input id="nomeAluno" placeholder="Ex.: Laysla VitÃ³ria" type="text"/>
</div>
<div>
<label class="q" for="idadeAluno">Idade</label>
<input id="idadeAluno" placeholder="Ex.: 24" type="number"/>
</div>
</div>
<div class="row">
<div>
<label class="q" for="sexo">Sexo biolÃ³gico</label>
<select id="sexo">
<option selected="" value="">Selecione...</option>
<option>Feminino</option>
<option>Masculino</option>
</select>
</div>
<div>
<label class="q" for="alturaAluno">Altura (cm)</label>
<input id="alturaAluno" placeholder="Ex.: 165" type="number"/>
</div>
</div>
<div class="row">
<div>
<label class="q" for="pesoAluno">Peso atual (kg)</label>
<input id="pesoAluno" placeholder="Ex.: 72.5" step="0.1" type="number"/>
</div>
<div>
<label class="q" for="whatsAluno">WhatsApp (DDD)</label>
<input id="whatsAluno" placeholder="Ex.: 69 9XXXX-XXXX" type="text"/>

</div>
</div>

<div class="row">
  <div>
    <label class="q" for="peso3m">Peso hÃ¡ 3 meses (kg)</label>
    <input id="peso3m" placeholder="Ex.: 75" step="0.1" type="number"/>
  </div>
  <div>
    <label class="q" for="peso12m">Peso hÃ¡ 12 meses (kg)</label>
    <input id="peso12m" placeholder="Ex.: 80" step="0.1" type="number"/>
  </div>
</div>

<div class="row">
  <div>
    <label class="q" for="tendenciaPeso">TendÃªncia do peso nos Ãºltimos 3 meses</label>
    <select id="tendenciaPeso">
      <option selected="" value="">Selecione...</option>
      <option>Subindo</option>
      <option>EstÃ¡vel</option>
      <option>Descendo</option>
      <option>Oscilando</option>
    </select>
  </div>
  <div>
    <label class="q" for="motivoVariacaoPeso">Motivo/observaÃ§Ã£o (se aplicÃ¡vel)</label>
    <input id="motivoVariacaoPeso" placeholder="Ex.: fÃ©rias, estresse, medicaÃ§Ã£o, etc." type="text"/>
  </div>
</div>

<div class="row">
<div>
<label class="q" for="cidadeAluno">Cidade / Estado</label>
<input id="cidadeAluno" placeholder="Ex.: Ji-ParanÃ¡ / RO" type="text"/>
</div>
</div>
</div>
<!-- SeÃ§Ã£o 1 â€“ Objetivo Principal -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 1 â€“ Objetivo Principal</div>
<label class="q" for="objetivo">1. Qual Ã© o seu principal objetivo com a dieta?</label>
<select id="objetivo">
<option selected="" value="">Selecione...</option>
<option>Emagrecimento / DefiniÃ§Ã£o corporal</option>
<option>Ganho de massa muscular (hipertrofia)</option>
<option>ReeducaÃ§Ã£o alimentar / ManutenÃ§Ã£o</option>
<option>Melhoria de performance / Energia</option>
<option>Controle metabÃ³lico / SaÃºde geral</option>
</select>
<div class="row" style="margin-top:10px;">
  <div>
    <label class="q" for="prazoMeta">2. Em quanto tempo vocÃª quer ver um resultado visÃ­vel?</label>
    <select id="prazoMeta">
      <option selected="" value="">Selecione...</option>
      <option>2â€“4 semanas</option>
      <option>6â€“8 semanas</option>
      <option>3 meses</option>
      <option>6 meses</option>
      <option>Sem prazo (foco em hÃ¡bitos)</option>
    </select>
    <p class="hint">Ajuda a calibrar agressividade do dÃ©ficit/superÃ¡vit e o nÃ­vel de flexibilidade do plano.</p>
  </div>
</div>

<section aria-live="polite" id="mfit-guide">
<h3>Guia rÃ¡pido: Metabolismo Ã— Objetivo</h3>
<div class="row">
<div>
<div class="muted">Resumo do metabolismo</div>
<div id="mfit-meta-desc"></div>
</div>
<div>
<div class="muted">Foco pelo objetivo</div>
<div id="mfit-obj-desc"></div>
</div>
</div>
<hr style="border:none;border-top:1px solid #1e1e1e;margin:12px 0"/>
<div class="row">
<div>
<div class="muted">Alimentos indicados</div>
<ul class="list" id="mfit-food-yes"></ul>
</div>
<div>
<div class="muted">Limitar / evitar</div>
<ul class="list" id="mfit-food-no"></ul>
</div>
</div>
<div class="muted" style="margin-top:10px;font-size:.95rem">As recomendaÃ§Ãµes se ajustam automaticamente quando vocÃª responde <b>Metabolismo</b> e <b>Objetivo</b> no formulÃ¡rio.</div>
</section>
<div aria-live="polite" id="mfit-locked-note" role="status">
<b>FaÃ§a o teste de metabolismo</b> para liberar as sugestÃµes de alimentos e o guia. Assim que o resultado aparecer, tudo serÃ¡ preenchido automaticamente conforme o seu <b>metabolismo</b> e o <b>objetivo</b>.
</div>
</div>
<!-- SeÃ§Ã£o 2 â€“ Tipo de Metabolismo -->
<div class="section" id="secMetabolismo">
<div class="section-title">ğŸ§¬ SeÃ§Ã£o 2 â€“ Metabolismo (7 perguntas)</div>
<p class="hint">Responda as 7 perguntas. Cada resposta soma pontos para Ectomorfo, Mesomorfo ou Endomorfo.</p>
<label class="q">1) Estrutura Ã³ssea (punho/tornozelo)</label>
<div>
<label><input name="m2_q1" type="radio" value="ecto"/> Muito fina</label><br/>
<label><input name="m2_q1" type="radio" value="meso"/> MÃ©dia</label><br/>
<label><input name="m2_q1" type="radio" value="endo"/> Grossa</label>
</div>
<label class="q" style="margin-top:10px;">2) Facilidade de ganhar/perder peso</label>
<div>
<label><input name="m2_q2" type="radio" value="ecto"/> Dificuldade para ganhar, perde fÃ¡cil</label><br/>
<label><input name="m2_q2" type="radio" value="meso"/> Ganha e perde com facilidade</label><br/>
<label><input name="m2_q2" type="radio" value="endo"/> Ganha fÃ¡cil, perde com dificuldade</label>
</div>
<label class="q" style="margin-top:10px;">3) Forma corporal predominante</label>
<div>
<label><input name="m2_q3" type="radio" value="ecto"/> LongilÃ­neo (ombros estreitos)</label><br/>
<label><input name="m2_q3" type="radio" value="meso"/> AtlÃ©tico (ombros largos)</label><br/>
<label><input name="m2_q3" type="radio" value="endo"/> Reto/arredondado (quadris largos)</label>
</div>
<label class="q" style="margin-top:10px;">4) AcÃºmulo de gordura</label>
<div>
<label><input name="m2_q4" type="radio" value="ecto"/> Pouco acÃºmulo mesmo em off</label><br/>
<label><input name="m2_q4" type="radio" value="meso"/> Moderado/distribuÃ­do</label><br/>
<label><input name="m2_q4" type="radio" value="endo"/> AcÃºmulo fÃ¡cil (abdÃ´men/quadril)</label>
</div>
<label class="q" style="margin-top:10px;">5) Apetite e saciedade</label>
<div>
<label><input name="m2_q5" type="radio" value="ecto"/> Apetite baixo/sacia rÃ¡pido</label><br/>
<label><input name="m2_q5" type="radio" value="meso"/> Apetite regulado</label><br/>
<label><input name="m2_q5" type="radio" value="endo"/> Apetite alto/fome frequente</label>
</div>
<label class="q" style="margin-top:10px;">6) Resposta a treinos de forÃ§a</label>
<div>
<label><input name="m2_q6" type="radio" value="ecto"/> Ganha forÃ§a lentamente</label><br/>
<label><input name="m2_q6" type="radio" value="meso"/> Ganha forÃ§a rÃ¡pido</label><br/>
<label><input name="m2_q6" type="radio" value="endo"/> Ganha forÃ§a moderada, cansa fÃ¡cil</label>
</div>
<label class="q" style="margin-top:10px;">7) Energia ao longo do dia</label>
<div>
  <label><input name="m2_q7" type="radio" value="ecto"/> Energia alta/agitado(a) (acorda â€œligadoâ€)</label><br/>
  <label><input name="m2_q7" type="radio" value="meso"/> Energia moderada/estÃ¡vel (mantÃ©m bem)</label><br/>
  <label><input name="m2_q7" type="radio" value="endo"/> Energia baixa/cansa fÃ¡cil (sonolÃªncia)</label>
</div>

<button class="btn" onclick="if(window.mfit_calcular_metabolismo_detalhado){window.mfit_calcular_metabolismo_detalhado();}" style="margin-top:14px;" type="button">
          Calcular metabolismo
        </button>
<p style="margin-top:10px;color:#cfcfcf;font-size:.9rem;">
          â¤ <strong>Resultado do metabolismo (teste detalhado):</strong>
<span id="metDetResultado" style="color:#29ff47;font-weight:600;">â€”</span>
</p>


<div id="secBiotipoVisual" class="subsection">
<div class="section-head">
    <div class="section-title">2C â€” Biotipo (visual)</div>
    <div class="section-sub">
      Selecione o biotipo que mais se aproxima do seu corpo (opcional). Este passo complementa o teste acima e ajuda quem nÃ£o sabe medir.
    </div>
  </div>

  <!-- Campo tÃ©cnico (salvo no app) -->
  <input type="hidden" id="metVisual" value="" />

  <div class="bio-grid" id="bioGrid" role="radiogroup" aria-label="Biotipo (visual)">
    <!-- ECTO -->
    <div class="bio-card" tabindex="0" role="radio" aria-checked="false" data-bio="Ectomorfo" data-meta="Ectomorfo">
      <div class="bio-media">
        <img class="bio-img" src="assets/biotipo_ectomorfo.svg" alt="Ectomorfo">
      </div>
      <div class="bio-body">
        <div class="bio-name">Ectomorfo</div>
        <div class="bio-desc">
          Ã‰ caracterizado por ter pouca gordura corporal, ossos densos, peitoral plano e maior dificuldade para ganhar peso,
          alÃ©m de metabolismo mais acelerado.
        </div>
        <div class="bio-bullets-title">CARACTERÃSTICAS:</div>
        <ul class="bio-bullets">
          <li>Magro</li>
          <li>Pernas e braÃ§os compridos e mais finos</li>
          <li>Ombros estreitos</li>
        </ul>
      </div>
      <div class="bio-radio" aria-hidden="true"></div>
    </div>

    <!-- MESO -->
    <div class="bio-card" tabindex="0" role="radio" aria-checked="false" data-bio="Mesomorfo" data-meta="Mesomorfo">
      <div class="bio-media">
        <img class="bio-img" src="assets/biotipo_mesomorfo.svg" alt="Mesomorfo">
      </div>
      <div class="bio-body">
        <div class="bio-name">Mesomorfo</div>
        <div class="bio-desc">
          Possui estrutura Ã³ssea maior, com aparÃªncia atlÃ©tica. Geralmente tem maior facilidade para ganhar massa muscular
          e responder bem ao treino de forÃ§a.
        </div>
        <div class="bio-bullets-title">CARACTERÃSTICAS:</div>
        <ul class="bio-bullets">
          <li>Ombros largos</li>
          <li>Cintura proporcional</li>
          <li>MÃºsculos bem definidos</li>
          <li>Formato corporal mais retangular</li>
        </ul>
      </div>
      <div class="bio-radio" aria-hidden="true"></div>
    </div>

    <!-- ENDO -->
    <div class="bio-card" tabindex="0" role="radio" aria-checked="false" data-bio="Endomorfo" data-meta="Endomorfo">
      <div class="bio-media">
        <img class="bio-img" src="assets/biotipo_endomorfo.svg" alt="Endomorfo">
      </div>
      <div class="bio-body">
        <div class="bio-name">Endomorfo</div>
        <div class="bio-desc">
          Tende a possuir metabolismo mais lento, com maior facilidade para ganhar gordura e boa capacidade de ganhar mÃºsculos,
          porÃ©m com mais dificuldade para emagrecer.
        </div>
        <div class="bio-bullets-title">CARACTERÃSTICAS:</div>
        <ul class="bio-bullets">
          <li>Corpo mais arredondado</li>
          <li>BraÃ§os mais curtos</li>
          <li>Pernas mais grossas</li>
        </ul>
      </div>
      <div class="bio-radio" aria-hidden="true"></div>
    </div>
  </div>

</div>

</div>
<!-- SeÃ§Ã£o 3 â€“ Rotina DiÃ¡ria -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 3 â€“ Rotina DiÃ¡ria</div>
<div class="row">
<div>
<label class="q" for="acorda">1. Que horas costuma acordar?</label>
<input id="acorda" placeholder="Ex.: 06:30" type="text"/>
</div>
<div>
<label class="q" for="dorme">2. Que horas costuma dormir?</label>
<input id="dorme" placeholder="Ex.: 22:30" type="text"/>
</div>
</div>
<label class="q">3. HorÃ¡rios de refeiÃ§Ãµes</label>
<div class="row">
<input id="cafeHorario" placeholder="CafÃ© da manhÃ£ â€“ Ex.: 07:00" type="text"/>
<input id="almocoHorario" placeholder="AlmoÃ§o â€“ Ex.: 12:00" type="text"/>
</div>
<input id="jantarHorario" placeholder="Jantar â€“ Ex.: 19:30" style="margin-top:10px;" type="text"/>
<label class="q" for="lanches">4. Faz lanches entre as refeiÃ§Ãµes?</label>
<select id="lanches">
<option selected="" value="">Selecione...</option>
<option>Sim</option>
<option>NÃ£o</option>
</select>
<label class="q" for="atividade">5. NÃ­vel de atividade fora da academia</label>
<select id="atividade">
<option selected="" value="">Selecione...</option>
<option>Leve (trabalho sentado)</option>
<option>Moderado (movimento ocasional)</option>
<option>Intenso (atividade fÃ­sica constante)</option>
</select>
</div>

<div class="row" style="margin-top:10px;">
  <div>
    <label class="q">4. Treina quais dias e em qual horÃ¡rio?</label>
    <div style="display:flex; gap:10px; align-items:center;">
      <select id="treinoDias" style="flex:1;">
        <option selected="" value="">Selecione os dias...</option>
        <option>Segâ€“Sex</option>
        <option>Segâ€“SÃ¡b</option>
        <option>Seg/Qua/Sex</option>
        <option>Ter/Qui/SÃ¡b</option>
        <option>Seg/Ter/Qui/Sex</option>
        <option>4x/sem (dias variÃ¡veis)</option>
        <option>5x/sem (dias variÃ¡veis)</option>
        <option>6x/sem (dias variÃ¡veis)</option>
        <option>SÃ¡b/Dom</option>
        <option>Escala/plantÃ£o (dias variÃ¡veis)</option>
        <option>NÃ£o treino</option>
      </select>
      <input id="treinoHorario" type="text" inputmode="numeric" placeholder="HH:MM" maxlength="5" style="width:140px;" />
    </div>
    <p class="hint" style="margin-top:6px;">Selecione os dias e informe o horÃ¡rio principal do treino (se variar, use â€œdias variÃ¡veisâ€).</p>
  </div>
  <div>
    <label class="q" for="passosDia">5. Passos/dia (mÃ©dia)</label>
    <input id="passosDia" placeholder="Ex.: 6000" type="number"/>
  </div>
</div>
<div class="row">
  <div>
    <label class="q" for="cardioExtra">6. Faz cardio fora da musculaÃ§Ã£o?</label>
    <input id="cardioExtra" placeholder="Ex.: 3x/sem 25 min (caminhada) | ou 'nÃ£o faÃ§o'" type="text"/>
    <p class="hint">Cardio extra altera o gasto e pode mudar carboidratos e estratÃ©gia de fome.</p>
  </div>
</div>

<!-- SeÃ§Ã£o 3.1 â€“ Rotina de AlimentaÃ§Ã£o -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 3.1 â€“ Sua Rotina de AlimentaÃ§Ã£o</div>
<label class="q" for="refeicoesDia">1. Quantas refeiÃ§Ãµes vocÃª costuma fazer por dia?</label>
<select id="refeicoesDia">
<option selected="" value="">Selecione...</option>
<option>2 refeiÃ§Ãµes</option>
<option>3 refeiÃ§Ãµes</option>
<option>4 refeiÃ§Ãµes</option>
<option>5 ou mais</option>
</select>
<label class="q" for="tempoPreparo">2. Quanto tempo vocÃª tem pra preparar comida?</label>
<select id="tempoPreparo">
<option selected="" value="">Selecione...</option>
<option>Preciso de coisa MUITO rÃ¡pida</option>
<option>Consigo fazer algo simples (frango, ovo, arroz)</option>
<option>Consigo cozinhar de boa</option>
</select>
<label class="q" for="custoDieta">3. NÃ­vel de custo da sua dieta</label>
<select id="custoDieta">
<option selected="" value="">Selecione...</option>
<option>VersÃ£o econÃ´mica (mais barata)</option>
<option>IntermediÃ¡ria</option>
<option>Posso investir mais</option>
</select>

<label class="q" for="localCompras">4. Onde vocÃª costuma comprar a maior parte da comida?</label>
<select id="localCompras">
  <option selected="" value="">Selecione...</option>
  <option>Supermercado</option>
  <option>Atacarejo / AtacadÃ£o</option>
  <option>Feira / Hortifruti</option>
  <option>AÃ§ougue</option>
  <option>Online / delivery</option>
  <option>Outro</option>
</select>

<label class="q" for="frequenciaCompras">5. Com que frequÃªncia vocÃª faz compras?</label>
<select id="frequenciaCompras">
  <option selected="" value="">Selecione...</option>
  <option>Quase todo dia</option>
  <option>2â€“3x por semana</option>
  <option>1x por semana</option>
  <option>A cada 15 dias</option>
  <option>1x por mÃªs</option>
</select>

<label class="q" for="temGeladeira">6. VocÃª tem geladeira e freezer funcionando?</label>
<select id="temGeladeira">
  <option selected="" value="">Selecione...</option>
  <option>Sim (geladeira + freezer ok)</option>
  <option>Parcial (geladeira ok, freezer ruim)</option>
  <option>NÃ£o</option>
</select>

<label class="q" for="podeMarmita">7. VocÃª consegue preparar marmitas e levar?</label>
<select id="podeMarmita">
  <option selected="" value="">Selecione...</option>
  <option>Sim</option>
  <option>Ã€s vezes</option>
  <option>NÃ£o</option>
</select>

<label class="q" for="horariosFixos">8. VocÃª tem horÃ¡rios fixos de refeiÃ§Ã£o?</label>
<select id="horariosFixos">
  <option selected="" value="">Selecione...</option>
  <option>Sim</option>
  <option>Parcial</option>
  <option>NÃ£o</option>
</select>

</div>
<!-- SeÃ§Ã£o 4 â€“ PreferÃªncias Alimentares -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 4 â€“ PreferÃªncias Alimentares</div>
<label class="q" for="estiloAlimentar">0. VocÃª segue algum estilo alimentar?</label>
<select id="estiloAlimentar">
<option selected="" value="">Nenhum / Como de tudo</option>
<option>Vegetariano (sem carne)</option>
<option>Vegano (sem nada animal)</option>
<option>Outro (descrever abaixo)</option>
</select>
<label class="q" for="estiloOutro">Se marcou "Outro", descreva</label>
<input id="estiloOutro" placeholder="Ex.: sem lactose / sÃ³ peixe / jejum intermitente" type="text"/>
<label class="q" for="gosta">1. Alimentos que gosta muito</label>
<textarea id="gosta" placeholder="Liste aqui..."></textarea>
<label class="q" for="naoGosta">2. Alimentos que NÃƒO gosta / NÃƒO COME</label>
<textarea id="naoGosta" placeholder="Ex.: ovo, peixe, salada crua, leiteâ€¦"></textarea>
<label class="q">3. RestriÃ§Ãµes alimentares</label>
<div class="row">
<label><input class="rest" type="checkbox" value="Lactose"/> Lactose</label>
<label><input class="rest" type="checkbox" value="GlÃºten"/> GlÃºten</label>
</div>
<div class="row">
<label><input class="rest" type="checkbox" value="Vegano"/> Vegano</label>
<label><input class="rest" type="checkbox" value="Vegetariano"/> Vegetariano</label>
</div>
<input id="restOutro" placeholder="Outro: descreva aqui (opcional)" style="margin-top:10px;" type="text"/>
<label class="q" for="alergias">4. Alergias alimentares</label>
<input id="alergias" placeholder="Ex.: amendoim, frutos do mar..." type="text"/>
</div>
<!-- SeÃ§Ã£o 4B â€“ Alimentos aceitos (com clique visÃ­vel) -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 4B â€“ Alimentos que vocÃª ACEITA comer</div>
<p class="hint">Toque nos alimentos que podem entrar na sua dieta. O que ficar verde e mostrar âœ“ estÃ¡ selecionado.</p>
<label class="q">CafÃ© da manhÃ£ / Lanches rÃ¡pidos</label>
<div class="food-grid" id="cafeGrid">
<div aria-pressed="false" class="food-card" data-value="Ovos" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥š</div>
<div class="label">Ovos</div>
</div>
<div aria-pressed="false" class="food-card" data-value="PÃ£o integral" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ</div>
<div class="label">PÃ£o integral</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Tapioca" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ®</div>
<div class="label">Tapioca</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Aveia" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ¾</div>
<div class="label">Aveia</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Frutas" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ</div>
<div class="label">Frutas</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Iogurte / leite desnatado" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥›</div>
<div class="label">Iogurte / leite desnatado</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Pasta de amendoim" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥œ</div>
<div class="label">Pasta de amendoim</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Whey Protein" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ’ª</div>
<div class="label">Whey Protein</div>
</div>
<!-- extras cafÃ© -->
<div aria-pressed="false" class="food-card" data-value="Isolado de soja (proteÃ­na isolada)" role="button">
  <div class="check-badge">âœ“</div>
  <div class="emoji">ğŸ«˜</div>
  <div class="label">Isolado de soja (extremamente proteico)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Panqueca de aveia" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥</div>
<div class="label">Panqueca de aveia</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Crepioca" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ³</div>
<div class="label">Crepioca</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Queijo cottage" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ§€</div>
<div class="label">Queijo cottage</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Iogurte grego natural" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¶</div>
<div class="label">Iogurte grego natural</div>
</div>
<!-- MFIT: opÃ§Ãµes econÃ´micas/altas em proteÃ­na (cafÃ©/snack) -->
<div aria-pressed="false" class="food-card" data-value="Claras de ovo" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥š</div>
<div class="label">Claras de ovo</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Iogurte grego zero (natural)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¶</div>
<div class="label">Iogurte grego zero (natural)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Carne seca / beef jerky" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥©</div>
<div class="label">Carne seca / beef jerky</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Banana com aveia" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ</div>
<div class="label">Banana com aveia</div>
</div>
</div>
<label class="q" style="margin-top:16px;">AlmoÃ§o / Jantar</label>
<div class="food-grid" id="almocoGrid">
<div aria-pressed="false" class="food-card" data-value="Frango" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ—</div>
<div class="label">Frango</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Patinho / carne magra" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥©</div>
<div class="label">Patinho / carne magra</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Carne de porco" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ·</div>
<div class="label">Carne de porco</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Peixe / TilÃ¡pia" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŸ</div>
<div class="label">Peixe / TilÃ¡pia</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Arroz" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸš</div>
<div class="label">Arroz</div>
</div>
<div aria-pressed="false" class="food-card" data-value="MacarrÃ£o" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ</div>
<div class="label">MacarrÃ£o</div>
</div>
<div aria-pressed="false" class="food-card" data-value="FeijÃ£o" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«˜</div>
<div class="label">FeijÃ£o</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Mandioca" role="button">
  <div class="check-badge">âœ“</div>
  <div class="emoji">ğŸ¥”</div>
  <div class="label">Mandioca</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Batata-doce" role="button">
  <div class="check-badge">âœ“</div>
  <div class="emoji">ğŸ </div>
  <div class="label">Batata-doce</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Salada / Legumes" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥—</div>
<div class="label">Salada / Legumes</div>
</div>
<!-- extras almoÃ§o/jantar -->
<div aria-pressed="false" class="food-card" data-value="Arroz integral" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸš</div>
<div class="label">Arroz integral</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Carne moÃ­da magra" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥©</div>
<div class="label">Carne moÃ­da magra</div>
</div>
<div aria-pressed="false" class="food-card" data-value="GrÃ£o-de-bico" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«˜</div>
<div class="label">GrÃ£o-de-bico</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Tofu" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ±</div>
<div class="label">Tofu</div>
</div>
<!-- MFIT: PROTEÃNAS econÃ´micas (mesma gramatura do plano; fÃ­gado 1â€“2x/semana) -->
<div aria-pressed="false" class="food-card" data-value="Moela de frango" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ—</div>
<div class="label">Moela de frango</div>
</div>
<div aria-pressed="false" class="food-card" data-value="CoraÃ§Ã£o de frango" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«€</div>
<div class="label">CoraÃ§Ã£o de frango</div>
</div>
<div aria-pressed="false" class="food-card" data-value="FÃ­gado bovino" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥©</div>
<div class="label">FÃ­gado bovino</div>
</div>
<div aria-pressed="false" class="food-card" data-value="CoraÃ§Ã£o bovino" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«€</div>
<div class="label">CoraÃ§Ã£o bovino</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Sardinha (lata/fresca)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŸ</div>
<div class="label">Sardinha (lata/fresca)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Peito de frango assado/cozido (sem pele)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ—</div>
<div class="label">Peito de frango assado/cozido (sem pele)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="CamarÃ£o cozido" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¤</div>
<div class="label">CamarÃ£o cozido</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Atum em Ã¡gua (enlatado, escorrido)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŸ</div>
<div class="label">Atum em Ã¡gua (enlatado, escorrido)</div>
</div>
<!-- MFIT: CARBOIDRATOS econÃ´micos -->
<div aria-pressed="false" class="food-card" data-value="Cuscuz" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸš</div>
<div class="label">Cuscuz</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Farinha de mandioca (com critÃ©rio)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ½</div>
<div class="label">Farinha de mandioca (com critÃ©rio)</div>
</div>
<!-- MFIT: GORDURAS econÃ´micas -->
<div aria-pressed="false" class="food-card" data-value="Azeite (quando couber no custo)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«’</div>
<div class="label">Azeite (quando couber no custo)</div>
</div>
<!-- MFIT: VEGETAIS/FRUTAS econÃ´micos (da estaÃ§Ã£o) -->
<div aria-pressed="false" class="food-card" data-value="Repolho" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥¬</div>
<div class="label">Repolho</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Cenoura" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥•</div>
<div class="label">Cenoura</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Banana (da semana)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ</div>
<div class="label">Banana (da semana)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="MamÃ£o (da semana)" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥­</div>
<div class="label">MamÃ£o (da semana)</div>
</div>
</div>
<label class="q" style="margin-top:16px;">Lanches / Snacks rÃ¡pidos</label>
<div class="food-grid" id="snackGrid">
<div aria-pressed="false" class="food-card" data-value="SanduÃ­che frango / atum" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥™</div>
<div class="label">SanduÃ­che frango / atum</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Rap10 / Wrap" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸŒ¯</div>
<div class="label">Rap10 / Wrap</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Fruta sozinha" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ</div>
<div class="label">Fruta sozinha</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Shake / vitamina" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥¤</div>
<div class="label">Shake / vitamina</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Isolado de soja (proteÃ­na isolada)" role="button">
  <div class="check-badge">âœ“</div>
  <div class="emoji">ğŸ«˜</div>
  <div class="label">Isolado de soja (extremamente proteico)</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Oleaginosas / amendoim" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥œ</div>
<div class="label">Oleaginosas / amendoim</div>
</div>
<!-- extras snacks -->
<div aria-pressed="false" class="food-card" data-value="Mix de nuts" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥œ</div>
<div class="label">Mix de nuts</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Barra de proteÃ­na" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ«</div>
<div class="label">Barra de proteÃ­na</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Iogurte zero" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥›</div>
<div class="label">Iogurte zero</div>
</div>
<!-- MFIT: snacks econÃ´micos/altos em proteÃ­na -->
<div aria-pressed="false" class="food-card" data-value="Amendoim torrado" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥œ</div>
<div class="label">Amendoim torrado</div>
</div>
<div aria-pressed="false" class="food-card" data-value="Ovos cozidos" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸ¥š</div>
<div class="label">Ovos cozidos</div>
</div>


<div aria-pressed="false" class="food-card" data-value="Cookie de aveia" role="button">
<div class="check-badge">âœ“</div>
<div class="emoji">ğŸª</div>
<div class="label">Cookie de aveia</div>
</div>
</div><label class="q">Bebidas</label>
<div class="food-grid" id="bebidasGrid">
  <div class="food-card" role="button" aria-pressed="false" data-value="CafÃ© preto (sem aÃ§Ãºcar)">
    <div class="check-badge">âœ“</div>
    <div class="emoji">â˜•</div>
    <div class="label">CafÃ© preto (sem aÃ§Ãºcar)</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="ChÃ¡ (sem aÃ§Ãºcar)">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸµ</div>
    <div class="label">ChÃ¡ (sem aÃ§Ãºcar)</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="Ãgua com gÃ¡s">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸ«§</div>
    <div class="label">Ãgua com gÃ¡s</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="Ãgua de coco">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸ¥¥</div>
    <div class="label">Ãgua de coco</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="Suco natural (sem aÃ§Ãºcar)">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸ§ƒ</div>
    <div class="label">Suco natural (sem aÃ§Ãºcar)</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="Leite desnatado">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸ¥›</div>
    <div class="label">Leite desnatado</div>
  </div>
  <div class="food-card" role="button" aria-pressed="false" data-value="Refrigerante zero">
    <div class="check-badge">âœ“</div>
    <div class="emoji">ğŸ¥¤</div>
    <div class="label">Refrigerante zero</div>
  </div>
</div>

<!-- SeÃ§Ã£o 5 â€“ SaÃºde e Exames -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 5 â€“ SaÃºde e Exames</div>
<label class="q" for="exames">1. JÃ¡ realizou exames laboratoriais recentes?</label>
<select id="exames">
<option selected="" value="">Selecione...</option>
<option>Sim</option>
<option>NÃ£o</option>
</select>
<label class="q" for="alteracoes">2. Se sim, hÃ¡ alguma alteraÃ§Ã£o relevante?</label>
<textarea id="alteracoes" placeholder="Descreva (ex.: glicemia alta, colesterol, etc.)"></textarea>
<label class="q" for="medic">3. Usa medicamentos contÃ­nuos?</label>
<input id="medic" placeholder="Quais?" type="text"/>
<label class="q">4. HistÃ³rico familiar</label>
<div class="row">
<label><input class="hist" type="checkbox" value="Diabetes"/> Diabetes</label>
<label><input class="hist" type="checkbox" value="Colesterol alto"/> Colesterol alto</label>
</div>
<label><input class="hist" type="checkbox" value="HipertensÃ£o"/> HipertensÃ£o</label>
</div>
<!-- SeÃ§Ã£o 6 â€“ Comprometimento -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 6 â€“ Comprometimento com a Dieta</div>
<select id="commit">
<option selected="" value="">Selecione...</option>
<option>Iniciante â€” quer comeÃ§ar leve</option>
<option>IntermediÃ¡rio â€” rotina prÃ¡tica, busca resultado</option>
<option>AvanÃ§ado â€” segue Ã  risca, performance mÃ¡xima</option>
</select>
<label class="q" for="maiorDificuldade" style="margin-top:10px;">2. Qual Ã© sua maior dificuldade para seguir a dieta?</label>
<select id="maiorDificuldade">
  <option selected="" value="">Selecione...</option>
  <option>OrganizaÃ§Ã£o / preparo das refeiÃ§Ãµes</option>
  <option>Fome (principalmente Ã  noite)</option>
  <option>Ansiedade / compulsÃ£o alimentar</option>
  <option>Rotina de trabalho / horÃ¡rios</option>
  <option>Financeiro (custo)</option>
  <option>Social / famÃ­lia / eventos</option>
  <option>Outro</option>
</select>
<label class="q" for="dificuldadeOutro">3. Se marcou â€œOutroâ€, descreva</label>
<input id="dificuldadeOutro" placeholder="Especifique (opcional)" type="text"/>

</div>
<!-- SeÃ§Ã£o 7 â€“ Faixa de Investimento -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 7 â€“ Faixa de Investimento</div>
<select id="invest">
<option selected="" value="">Selecione...</option>
<option>EconÃ´mico â€” alimentos simples e acessÃ­veis</option>
<option>MÃ©dio â€” variedade moderada</option>
<option>Alta â€” aceita opÃ§Ãµes e suplementos premium</option>
</select>
</div>
<!-- SeÃ§Ã£o 8 â€“ SuplementaÃ§Ã£o -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 8 â€“ SuplementaÃ§Ã£o</div>
<label class="q" for="usaSup">1. VocÃª jÃ¡ usa suplemento atualmente?</label>
<select id="usaSup">
<option selected="" value="">Selecione...</option>
<option>NÃ£o uso suplemento</option>
<option>Sim, uso suplemento</option>
</select>
<label class="q" for="quaisSup">2. Se usa, quais?</label>
<input id="quaisSup" placeholder="Ex.: Whey, creatina, cafeÃ­na..." type="text"/>
<label class="q" for="incluirSup">3. Quer que eu inclua suplemento no plano?</label>
<select id="incluirSup">
<option selected="" value="">Selecione...</option>
<option>Sim, pode incluir sugestÃµes</option>
<option>Sim, mas sÃ³ o essencial / barato</option>
<option>NÃ£o quero suplemento agora</option>
</select>
</div>
<!-- SeÃ§Ã£o 9 â€“ HidrataÃ§Ã£o -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 9 â€“ HidrataÃ§Ã£o</div>
<label class="q" for="agua">Consumo mÃ©dio diÃ¡rio de Ã¡gua</label>
<select id="agua">
<option selected="" value="">Selecione...</option>
<option>&lt; 1L</option>
<option>1â€“2L</option>
<option>2â€“3L</option>
<option>&gt; 3L</option>
</select>
</div>
<!-- SeÃ§Ã£o 10 â€“ Estilo de Vida -->
<div class="section">
<div class="section-title">SeÃ§Ã£o 10 â€“ Estilo de Vida</div>
<div class="row">
<div>
<label class="q" for="alcool">1. Consome bebidas alcoÃ³licas?</label>
<select id="alcool">
<option selected="" value="">Selecione...</option>
<option>Sim</option>
<option>NÃ£o</option>
<option>Ã€s vezes</option>
</select>
</div>
<div>
<label class="q" for="fuma">2. Fuma?</label>
<select id="fuma">
<option selected="" value="">Selecione...</option>
<option>Sim</option>
<option>NÃ£o</option>
</select>
</div>
</div>

<div class="row">
  <div>
    <label class="q" for="cafeinaConsumo">2B. CafeÃ­na / estimulantes (cafÃ©, energÃ©tico, prÃ©-treino)</label>
    <select id="cafeinaConsumo">
      <option selected="" value="">Selecione...</option>
      <option>NÃ£o</option>
      <option>Sim (1â€“2x/dia)</option>
      <option>Sim (3+ vezes/dia)</option>
    </select>
  </div>
  <div>
    <label class="q" for="cafeinaUltimoHorario">Ãšltimo horÃ¡rio de cafeÃ­na (aprox.)</label>
    <input id="cafeinaUltimoHorario" type="time"/>
  </div>
</div>

<label class="q" for="cafeinaObservacao">ObservaÃ§Ã£o (energÃ©tico/prÃ©-treino/dose)</label>
<input id="cafeinaObservacao" placeholder="Ex.: 200 mg cafeÃ­na prÃ©-treino Ã s 18:00" type="text"/>

<div class="row">
<div>
<label class="q" for="estresse">3. NÃ­vel de estresse</label>
<select id="estresse">
<option selected="" value="">Selecione...</option>
<option>Baixo</option>
<option>MÃ©dio</option>
<option>Alto</option>
</select>
</div>
<div>
<label class="q" for="sonoQualidade">4. Dorme bem Ã  noite?</label>
<select id="sonoQualidade">
<option selected="" value="">Selecione...</option>
<option>Sim</option>
<option>NÃ£o</option>
</select>
</div>
</div>
<div class="row">
<div>
<label class="q" for="sonoHoras">5. Quantas horas de sono por noite (mÃ©dia)?</label>
<select id="sonoHoras">
<option selected="" value="">Selecione...</option>
<option>Menos de 5h</option>
<option>5h a 6h</option>
<option>7h a 8h</option>
<option>Mais de 8h</option>
</select>
</div>
<div>
<label class="q" for="lixo">6. Fast food / doce / refrigerante</label>
<select id="lixo">
<option selected="" value="">Selecione...</option>
<option>Quase nunca</option>
<option>Ã€s vezes</option>
<option>Quase todo dia</option>
</select>

<div class="row" style="margin-top:10px;">
  <div>
    <label class="q" for="fomePeriodos">7. Em qual perÃ­odo vocÃª sente mais fome?</label>
    <select id="fomePeriodos">
      <option selected="" value="">Selecione...</option>
      <option>ManhÃ£</option>
      <option>Tarde</option>
      <option>Noite</option>
      <option>Madrugada</option>
      <option>VariÃ¡vel</option>
    </select>
  </div>
  <div>
    <label class="q" for="compulsao">8. Come por ansiedade / compulsÃ£o?</label>
    <select id="compulsao">
      <option selected="" value="">Selecione...</option>
      <option>Nunca</option>
      <option>Ã€s vezes</option>
      <option>Frequente</option>
    </select>
  </div>
</div>
<label class="q" for="digestaoObs">9. DigestÃ£o (azia, refluxo, intestino, gases) â€” observaÃ§Ãµes</label>
<textarea id="digestaoObs" placeholder="Descreva o que acontece e em quais alimentos/horÃ¡rios (opcional)."></textarea>
</div>
</div>
</div>
<!-- SeÃ§Ã£o 11 â€“ PrÃ©via AutomÃ¡tica da Dieta (Objetivo Ã— Metabolismo) -->


<!-- SeÃ§Ã£o 11 â€“ RecordatÃ³rio 24h (opcional) -->
<div class="section">
  <div class="section-title">SeÃ§Ã£o 11 â€“ RecordatÃ³rio 24h (opcional)</div>
  <p class="hint">Escreva o que comeu/beber nas Ãºltimas 24h, com quantidades aproximadas. Isso aumenta muito a precisÃ£o do ajuste inicial.</p>
  <label class="q" for="recordatorio24h">Descreva (por refeiÃ§Ã£o)</label>
  <textarea id="recordatorio24h" placeholder="Ex.: 07:00 2 ovos + 1 pÃ£o; 12:00 150g arroz + 120g frango; 16:00 cafÃ© + 1 banana; 20:00 200g macarrÃ£o + carne..."></textarea>
</div>

<!-- SeÃ§Ã£o 12 â€“ CardÃ¡pio Sugerido â€“ Dia 1 -->
<div class="section" id="secDay1">
<div class="section-title">SeÃ§Ã£o 12 â€“ CardÃ¡pio Sugerido â€“ Dia 1</div>
<p class="hint">Gerado automaticamente conforme objetivo, metabolismo, peso, refeiÃ§Ãµes/dia e alimentos ACEITOS.</p>
<div id="dayPlan" style="white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#0f1110; border:1px solid #222; padding:12px; border-radius:10px;">
          A prÃ©via do cardÃ¡pio aparecerÃ¡ aqui quando os campos estiverem preenchidos.
        </div>
</div>
<!-- BOTÃ•ES FINAIS -->
<div class="btns">
<button class="btn" id="sendBtn" type="button">ğŸ“² Enviar respostas no WhatsApp</button>
</div>
<div class="error" id="err">Preencha pelo menos o objetivo antes de enviar.</div>
</form>
</div>
<script>
  // ====== LOGO (Android content://) ======
  // Funciona mesmo abrindo o HTML como arquivo no celular.

  const phone = "556992913628"; // +55 69 99291-3628

  // ====== HELPERS ======
  const $ = (id) => document.getElementById(id);
  function val(id){ const el=$(id); return el ? el.value : ""; }

  // ====== SeleÃ§Ã£o dos cards de alimento ======
  function setupFoodGrid(gridId){
    const grid = $(gridId);
    if(!grid) return;
    grid.querySelectorAll('.food-card').forEach(card=>{
      card.addEventListener('click', ()=>{
        card.classList.toggle('selected');
        card.setAttribute('aria-pressed', card.classList.contains('selected') ? 'true' : 'false');
        save();
      });
    });
  }

  function getSelectedList(gridId){
    const grid = $(gridId);
    if(!grid) return [];
    return Array.from(grid.querySelectorAll('.food-card.selected')).map(c => c.getAttribute('data-value'));
  }

  function restoreSelectedList(gridId, arr){
    const grid = $(gridId);
    if(!grid || !arr) return;
    grid.querySelectorAll('.food-card').forEach(card=>{
      const on = arr.includes(card.getAttribute('data-value'));
      card.classList.toggle('selected', on);
      card.setAttribute('aria-pressed', on ? 'true' : 'false');
    });
  }

  function listSelectedPretty(gridId){
    const grid = $(gridId);
    if(!grid) return "";
    const sel = grid.querySelectorAll('.food-card.selected');
    return Array.from(sel).map(c => "- " + c.getAttribute('data-value')).join("\\n");
  }

  // ====== PersistÃªncia local ======
  const fields = [
    "nomeAluno","idadeAluno","sexo","alturaAluno","pesoAluno","whatsAluno","cidadeAluno",
    "objetivo","prazoMeta",
    "met1","met2","met3","met4","met5","metVisual",
    "acorda","dorme","cafeHorario","almocoHorario","jantarHorario","lanches","atividade","treinoDias","treinoHorario","passosDia","cardioExtra",
    "refeicoesDia","tempoPreparo","custoDieta",
    "estiloAlimentar","estiloOutro","gosta","naoGosta","restOutro","alergias",
    "exames","alteracoes","medic",
    "commit","maiorDificuldade","dificuldadeOutro",
    "invest",
    "usaSup","quaisSup","incluirSup",
    "agua",
    "alcool","fuma","estresse","sonoQualidade","sonoHoras","lixo","fomePeriodos","compulsao","digestaoObs","recordatorio24h"
  ];

  function save(){
    const d = {};
    fields.forEach(f=>{
      const el=$(f);
      if(el){ d[f]=el.value; }
    });

    d._rest = Array.from(document.querySelectorAll('.rest:checked')).map(x=>x.value);
    d._hist = Array.from(document.querySelectorAll('.hist:checked')).map(x=>x.value);

    d._cafeSel  = getSelectedList("cafeGrid");
    d._almocoSel= getSelectedList("almocoGrid");
    d._snackSel = getSelectedList("snackGrid");
    d._bebidasSel = getSelectedList("bebidasGrid");

    localStorage.setItem("mfit_dieta_modelo_v32", JSON.stringify(d));
    // atualizar prÃ©via e cardÃ¡pio automÃ¡tico
    try{ refreshPreview(); refreshDayPlan(); }catch(e){}
  }

  function load(){
    try{
      const d = JSON.parse(localStorage.getItem("mfit_dieta_modelo_v32")||"{}");

      fields.forEach(f=>{
        const el=$(f);
        if(el && d[f]!==undefined){
          el.value=d[f];
        }
      });

      if(d._rest){
        Array.from(document.querySelectorAll('.rest')).forEach(x=>{
          x.checked = d._rest.includes(x.value);
        });
      }

      if(d._hist){
        Array.from(document.querySelectorAll('.hist')).forEach(x=>{
          x.checked = d._hist.includes(x.value);
        });
      }

      if(d._cafeSel){ restoreSelectedList("cafeGrid", d._cafeSel); }
      if(d._almocoSel){ restoreSelectedList("almocoGrid", d._almocoSel); }
      if(d._snackSel){ restoreSelectedList("snackGrid", d._snackSel); }
      if(d._bebidasSel){ restoreSelectedList("bebidasGrid", d._bebidasSel); }

    }catch(e){}
  }

  // ====== Metabolismo automÃ¡tico ======
  function mfit_classificar_metabolismo(){
    const v1=val("met1"), v2=val("met2"), v3=val("met3"), v4=val("met4"), v5=val("met5");
    let ecto=0, meso=0, endo=0;

    if(v1==="Com dificuldade") ecto++;
    if(v1==="Com facilidade") endo++;

    if(v2==="Mais magro") ecto++;
    if(v2==="MÃ©dio") meso++;
    if(v2==="Mais largo") endo++;

    if(v3==="Sim") ecto++;
    if(v3==="NÃ£o") endo++;

    if(v4==="Baixo") ecto++;
    if(v4==="Alto") endo++;

    if(v5==="Alta o tempo todo") ecto++;
    if(v5==="Baixa com frequÃªncia") endo++;
    if(v5==="Regular") meso++;

    const res = (ecto>meso && ecto>endo) ? "Ectomorfo"
              : (endo>meso && endo>ecto) ? "Endomorfo"
              : "Mesomorfo";

    const spot = $("metResultado");
    if(spot){ spot.textContent = res; }
    return res;
  }


  // ====== LÃ“GICA MFIT v6.2 (PrÃ©via + CardÃ¡pio Dia 1) ======
  function getObjetivo(){ return val("objetivo"); }
  function getMet(){ return mfit_classificar_metabolismo(); }

  function activityFactor(){
    const a = val("atividade");
    if(a.includes("Leve")) return 1.2;
    if(a.includes("Moderado")) return 1.4;
    if(a.includes("Intenso")) return 1.6;
    return 1.2;
  }

  function goalAdjust(baseKcal, objetivo, metabolismo){
    let pct = 0.0;
    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(objetivo)){
      pct = -0.15;
      if(metabolismo==="Endomorfo") pct = -0.18;
      if(metabolismo==="Ectomorfo") pct = -0.12;
    }else if(/Ganho de massa|Hipertrofia/i.test(objetivo)){
      pct = 0.12;
      if(metabolismo==="Ectomorfo") pct = 0.17;
      if(metabolismo==="Endomorfo") pct = 0.10;
    }else{
      pct = 0.0;
    }
    return Math.round(baseKcal * (1 + pct));
  }

  function pickMacros(objetivo, metabolismo, peso){
    let prot, carb, gord;
    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(objetivo)){
      if(metabolismo==="Ectomorfo"){ prot=2.1; carb=2.5; gord=0.7; }
      else if(metabolismo==="Endomorfo"){ prot=2.3; carb=1.9; gord=0.9; }
      else { prot=1.9; carb=2.2; gord=0.8; }
    }else if(/Ganho de massa|Hipertrofia/i.test(objetivo)){
      if(metabolismo==="Ectomorfo"){ prot=1.9; carb=4.7; gord=0.7; }
      else if(metabolismo==="Endomorfo"){ prot=2.0; carb=3.0; gord=0.9; }
      else { prot=1.7; carb=4.0; gord=0.8; }
    }else{
      if(metabolismo==="Ectomorfo"){ prot=1.8; carb=3.5; gord=0.8; }
      else if(metabolismo==="Endomorfo"){ prot=2.0; carb=2.5; gord=0.9; }
      else { prot=1.8; carb=3.0; gord=0.8; }
    }
    return {
      prot: Math.round(prot * (parseFloat(peso)||0)),
      carb: Math.round(carb * (parseFloat(peso)||0)),
      gord: Math.round(gord * (parseFloat(peso)||0)),
    };
  }

  function estimateBMR(weight, height, age, sexo){
    const s = (sexo==="Masculino")?5:-161;
    const h = (parseFloat(height)||170);
    const a = (parseFloat(age)||30);
    const w = (parseFloat(weight)||0);
    if(w<=0) return 0;
    return Math.round(10*w + 6.25*h - 5*a + s);
  }

  function gramsToKcal(g){
    return Math.round(g.prot*4 + g.carb*4 + g.gord*9);
  }

  function distributePerMeals(targets, nMeals){
    const meals = Math.max(2, Math.min(6, parseInt(nMeals)||3));
    const per = {
      prot: Math.round(targets.prot / meals),
      carb: Math.round(targets.carb / meals),
      gord: Math.round(targets.gord / meals),
    };
    return { meals, per };
  }

  function joinChecks(selector){
    const arr = Array.from(document.querySelectorAll(selector+":checked")).map(x=>x.value);
    return arr.length? arr.join(", ") : "";
  }

  function listSelectedPretty(gridId){
    const grid = document.getElementById(gridId);
    if(!grid) return "";
    const sel = grid.querySelectorAll('.food-card.selected');
    return Array.from(sel).map(c => "- " + c.getAttribute('data-value')).join("\\n");
  }

  function buildDietPreview(){
    const peso = parseFloat(val("pesoAluno"))||0;
    const altura = parseFloat(val("alturaAluno"))||0;
    const idade = parseFloat(val("idadeAluno"))||0;
    const sexo = val("sexo")||"Masculino";
    const objetivo = getObjetivo();
    const metabolismo = getMet();
    const refeicoes = val("refeicoesDia")||"3 refeiÃ§Ãµes";

    if(!objetivo || !peso || !altura || !idade){
      return "Preencha objetivo, peso, altura e idade para calcular a prÃ©via.";
    }

    const bmr = estimateBMR(peso, altura, idade, sexo);
    const tdee = Math.round(bmr * activityFactor());
    const kcal = goalAdjust(tdee, objetivo, metabolismo);
    const macros = pickMacros(objetivo, metabolismo, peso);
    const kcalFromMacros = gramsToKcal(macros);

    let diff = kcal - kcalFromMacros;
    let gordAdj = macros.gord + Math.round(diff/9);
    if(gordAdj < 0) gordAdj = 0;
    const macrosAdj = { prot: macros.prot, carb: macros.carb, gord: gordAdj };
    const kcalAdj = gramsToKcal(macrosAdj);

    const nMeals = parseInt((refeicoes.match(/\d+/)||[3])[0]);
    const dist = distributePerMeals(macrosAdj, nMeals);

    const prefs = (val("gosta")||"").trim();
    const nao = (val("naoGosta")||"").trim();
    const rest = joinChecks(".rest");
    const alerg = val("alergias")||"";
    const aceitaCafe = listSelectedPretty("cafeGrid");
    const aceitaAlmoco = listSelectedPretty("almocoGrid");
    const aceitaSnack = listSelectedPretty("snackGrid");
    const aceitaBebidas = listSelectedPretty("bebidasGrid");

    const linhas = [];
    linhas.push(`ğŸ¯ Objetivo: ${objetivo}`);
    linhas.push(`ğŸ§¬ Metabolismo: ${metabolismo}`);
    linhas.push(`âš–ï¸ Peso: ${peso} kg Â· Altura: ${altura} cm Â· Idade: ${idade}`);
    linhas.push(`ğŸ”¥ BMR (est.): ${bmr} kcal Â· TDEE (atividade): ${tdee} kcal`);
    linhas.push(`ğŸ“Š Alvo calÃ³rico diÃ¡rio: ${kcalAdj} kcal`);
    linhas.push(`ğŸ½ï¸ RefeiÃ§Ãµes/dia: ${dist.meals}`);
    linhas.push(`ğŸ¥© ProteÃ­na: ${macrosAdj.prot} g/dia`);
    linhas.push(`ğŸš Carbo: ${macrosAdj.carb} g/dia`);
    linhas.push(`ğŸ¥‘ Gorduras: ${macrosAdj.gord} g/dia`);
    linhas.push(`â€” Por refeiÃ§Ã£o (~${dist.meals}x/dia): Prot ${dist.per.prot} g Â· Carb ${dist.per.carb} g Â· Gord ${dist.per.gord} g`);

    if(prefs || nao || rest || alerg){
      linhas.push("");
      linhas.push("âœ… PreferÃªncias/RestriÃ§Ãµes:");
      if(prefs) linhas.push("â€¢ Gosta: " + prefs.replace(/\n+/g," "));
      if(nao)   linhas.push("â€¢ NÃ£o come: " + nao.replace(/\n+/g," "));
      if(rest)  linhas.push("â€¢ RestriÃ§Ãµes: " + rest);
      if(alerg) linhas.push("â€¢ Alergias: " + alerg);
    }
    if(aceitaCafe || aceitaAlmoco || aceitaSnack || aceitaBebidas){
      linhas.push("");
      linhas.push("ğŸ§¾ Itens ACEITOS (cards):");
      if(aceitaCafe)    linhas.push("â€¢ CafÃ©/Lanches:\n" + aceitaCafe);
      if(aceitaAlmoco)  linhas.push("â€¢ AlmoÃ§o/Jantar:\n" + aceitaAlmoco);
      if(aceitaSnack)   linhas.push("â€¢ Snacks:\n" + aceitaSnack);
      if(aceitaBebidas) linhas.push("â€¢ Bebidas:\n" + aceitaBebidas);
    }
    return linhas.join("\n");
  }

  // ====== GERAÃ‡ÃƒO DE CARDÃPIO â€“ DIA 1 ======
  function pickOne(arr){ return (arr && arr.length)? arr[Math.floor(Math.random()*arr.length)] : ""; }
  function ensurePool(pool, fallback){ return (pool && pool.length)? pool : fallback; }
  function poolCafe(){ return getSelectedList("cafeGrid"); }
  function poolAlmoco(){ return getSelectedList("almocoGrid"); }
  function poolSnack(){ return getSelectedList("snackGrid"); }

  const BASES = {
    cafe: ["Ovos","PÃ£o integral","Aveia","Frutas","Iogurte / leite desnatado","Tapioca","Whey Protein","Pasta de amendoim"],
    almoco: ["Frango","Patinho / carne magra","Peixe / TilÃ¡pia","Arroz","FeijÃ£o","Mandioca","Batata-doce","Salada / Legumes","MacarrÃ£o"],
    snack: ["Fruta sozinha","Shake / vitamina","Oleaginosas / amendoim","Rap10 / Wrap","SanduÃ­che frango / atum"]
  };

  function styleByGoalMeta(obj, meta){
    const s = { carbs: "moderado", fats: "moderado", protein: "alto", notes: [] };
    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(obj)){
      s.carbs = (meta==="Endomorfo")? "baixo" : "moderado";
      s.fats  = (meta==="Endomorfo")? "moderado-alto" : "moderado";
      s.protein = "alto";
      s.notes.push("DÃ©ficit calÃ³rico; foco em proteÃ­nas e fibras.");
    }else if(/Ganho de massa|Hipertrofia/i.test(obj)){
      s.carbs = (meta==="Ectomorfo")? "alto" : (meta==="Mesomorfo"?"moderado-alto":"moderado");
      s.fats  = "moderado";
      s.protein = "moderado-alto";
      s.notes.push("SuperÃ¡vit calÃ³rico com Ãªnfase em carbo complexos.");
    }else{
      s.carbs = "moderado";
      s.fats  = "moderado";
      s.protein = "moderado-alto";
      s.notes.push("EquilÃ­brio e densidade nutricional.");
    }
    return s;
  }

  function makePlate(style){
    let q = {
      prot: (style.protein==="alto"? "30â€“40 g" : style.protein==="moderado-alto" ? "25â€“35 g" : "20â€“30 g"),
      carb: (style.carbs==="alto"? "60â€“90 g" : style.carbs==="moderado-alto" ? "45â€“70 g" : style.carbs==="moderado" ? "30â€“50 g" : "15â€“30 g"),
      fat:  (style.fats==="moderado-alto"? "15â€“25 g" : "10â€“20 g")
    };
    function gramsFood(name){
      const map = {
        "Ovos":"2â€“3 un",
        "PÃ£o integral":"2 fatias (60â€“80 g)",
        "Aveia":"40â€“60 g",
        "Frutas":"1â€“2 porÃ§Ãµes",
        "Iogurte / leite desnatado":"200 ml",
        "Tapioca":"1 disco (50â€“70 g)",
        "Whey Protein":"1 dose (25â€“30 g)",
        "Pasta de amendoim":"1â€“2 col (15â€“30 g)",
        "Frango":"120â€“180 g",
        "Patinho / carne magra":"120â€“180 g",
        "Peixe / TilÃ¡pia":"120â€“180 g",
        "Arroz":"120â€“180 g cozido",
        "FeijÃ£o":"100â€“150 g cozido",
        "Mandioca":"120â€“180 g",
        "Batata-doce":"120â€“180 g",
        "Salada / Legumes":"Ã  vontade",
        "MacarrÃ£o":"120â€“160 g cozido",
        "Fruta sozinha":"1 porÃ§Ã£o",
        "Shake / vitamina":"300â€“400 ml",
        "Oleaginosas / amendoim":"20â€“30 g",
        "Rap10 / Wrap":"1 un",
        "SanduÃ­che frango / atum":"1 un"
      };
      return map[name] || "";
    }
    return function combo(p1,p2,p3){
      const parts = [];
      if(p1) parts.push(`${p1} (${gramsFood(p1)})`);
      if(p2) parts.push(`${p2} (${gramsFood(p2)})`);
      if(p3) parts.push(`${p3} (${gramsFood(p3)})`);
      return { text: parts.join(" + "), targets: q };
    }
  }

  function buildDayPlan(){
    const objetivo = val("objetivo");
    const meta = mfit_classificar_metabolismo();
    const refeicoesTxt = val("refeicoesDia") || "5 refeiÃ§Ãµes";
    const mealsNum = parseInt((refeicoesTxt.match(/\d+/)||[5])[0]) || 5;

    if(!objetivo){
      return "Selecione um objetivo (SeÃ§Ã£o 1) para gerar o cardÃ¡pio.";
    }
    const cafePool = ensurePool(poolCafe(), BASES.cafe);
    const almocoPool = ensurePool(poolAlmoco(), BASES.almoco);
    const snackPool = ensurePool(poolSnack(), BASES.snack);

    const style = styleByGoalMeta(objetivo, meta);
    const make = makePlate(style);

    let cafeP1 = pickOne(cafePool.filter(x=>["Ovos","Whey Protein","Iogurte / leite desnatado"].includes(x))) || pickOne(cafePool);
    let cafeP2 = pickOne(cafePool.filter(x=>["PÃ£o integral","Aveia","Tapioca","Frutas"].includes(x))) || pickOne(cafePool);
    let cafeP3 = pickOne(cafePool.filter(x=>["Frutas","Pasta de amendoim"].includes(x))) || "";

    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(objetivo) && meta==="Endomorfo"){
      if(["PÃ£o integral","Tapioca"].includes(cafeP2)) cafeP2 = "Frutas";
    }
    if(/Ganho de massa|Hipertrofia/i.test(objetivo) && meta==="Ectomorfo"){
      if(cafeP2==="Frutas") cafeP3 = pickOne(cafePool.filter(x=>["PÃ£o integral","Aveia","Tapioca"].includes(x))) || cafeP3;
    }

    let lanche1P1 = pickOne(snackPool.filter(x=>["Shake / vitamina","Whey Protein","Iogurte / leite desnatado"].includes(x))) || pickOne(snackPool);
    let lanche1P2 = pickOne(snackPool.filter(x=>["Fruta sozinha","Oleaginosas / amendoim"].includes(x))) || "";

    let almP1 = pickOne(almocoPool.filter(x=>["Frango","Patinho / carne magra","Peixe / TilÃ¡pia"].includes(x))) || pickOne(almocoPool);
    let almP2 = pickOne(almocoPool.filter(x=>["Arroz","MacarrÃ£o","Mandioca","Batata-doce","FeijÃ£o"].includes(x))) || "";
    let almP3 = almocoPool.includes("Salada / Legumes")? "Salada / Legumes" : pickOne(almocoPool);

    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(objetivo) && meta==="Endomorfo"){
      if(["MacarrÃ£o"].includes(almP2)) almP2 = "Mandioca","Batata-doce";
    }
    if(/Ganho de massa|Hipertrofia/i.test(objetivo) && meta==="Ectomorfo"){
      if(almocoPool.includes("Arroz")) almP2 = "Arroz";
    }

    let lanche2P1 = pickOne(snackPool.filter(x=>["Rap10 / Wrap","SanduÃ­che frango / atum","Whey Protein","Shake / vitamina"].includes(x))) || pickOne(snackPool);
    let lanche2P2 = pickOne(snackPool.filter(x=>["Fruta sozinha","Oleaginosas / amendoim"].includes(x))) || "";

    let janP1 = pickOne(almocoPool.filter(x=>["Peixe / TilÃ¡pia","Frango","Patinho / carne magra"].includes(x))) || pickOne(almocoPool);
    let janP2 = pickOne(almocoPool.filter(x=>["Mandioca","Batata-doce","Arroz","FeijÃ£o"].includes(x))) || "";
    let janP3 = almocoPool.includes("Salada / Legumes")? "Salada / Legumes" : pickOne(almocoPool);

    if(/Emagrecimento|DefiniÃ§Ã£o/i.test(objetivo)){
      if(janP2==="Arroz") janP2 = "Mandioca","Batata-doce";
      if(meta==="Endomorfo") janP2 = "";
    }

    let ceia = "";
    if(mealsNum >= 5){
      const ceiaP1 = pickOne(cafePool.filter(x=>["Iogurte / leite desnatado","Whey Protein","Ovos"].includes(x))) || "";
      const ceiaP2 = pickOne(snackPool.filter(x=>["Oleaginosas / amendoim","Fruta sozinha"].includes(x))) || "";
      if(ceiaP1){
        const mk = make;
        ceia = mk(ceiaP1, ceiaP2, "");
      }
    }

    const cafe = make(cafeP1, cafeP2, cafeP3);
    const lanche1 = make(lanche1P1, lanche1P2, "");
    const almoco = make(almP1, almP2, almP3);
    const lanche2 = make(lanche2P1, lanche2P2, "");
    const jantar = make(janP1, janP2, janP3);

    const linhas = [];
    linhas.push(`ğŸ¯ Objetivo: ${objetivo} | ğŸ§¬ Metabolismo: ${meta}`);
    linhas.push(`ğŸ“Œ Estilo do dia â†’ Carbo: ${style.carbs} Â· Gorduras: ${style.fats} Â· ProteÃ­na: ${style.protein}`);
    linhas.push("");
    linhas.push(`ğŸ³ CafÃ© da manhÃ£: ${cafe.text}`);
    linhas.push(`ğŸ¥¤ Lanche 1: ${lanche1.text}`);
    linhas.push(`ğŸ½ï¸ AlmoÃ§o: ${almoco.text}`);
    linhas.push(`ğŸ¥ª Lanche 2: ${lanche2.text}`);
    linhas.push(`ğŸ² Jantar: ${jantar.text}`);
    if(ceia && ceia.text) linhas.push(`ğŸŒ™ Ceia (opcional): ${ceia.text}`);
    linhas.push("");
    linhas.push(`â„¹ï¸ Metas por refeiÃ§Ã£o (aprox.): Prot ${cafe.targets.prot} Â· Carb ${cafe.targets.carb} Â· Gord ${cafe.targets.fat}`);
    return linhas.join("\n");
  }

  function refreshPreview(){
    const box = box;
    if(!box){ return; }

    const el = document.getElementById("previewCalc");
    if(!el) return;
    el.textContent = buildDietPreview();
  }

  function refreshDayPlan(){
    const el = document.getElementById("dayPlan");
    if(!el) return;
    el.textContent = buildDayPlan();
  }

  // ====== Mensagem pro WhatsApp ======
  function joinChecks(selector){
    const arr = Array.from(document.querySelectorAll(selector+":checked")).map(x=>x.value);
    return arr.length? arr.join(", ") : "";
  }

  function buildMessage(){
    const texto =
`ğŸ Dieta personalizada

ğŸ‘¤ DADOS DO ALUNO
Nome: ${val("nomeAluno")}
Idade: ${val("idadeAluno")}
Sexo biolÃ³gico: ${val("sexo")}
Altura: ${val("alturaAluno")} cm
Peso: ${val("pesoAluno")} kg
Peso hÃ¡ 3 meses: ${val("peso3m")} kg
Peso hÃ¡ 12 meses: ${val("peso12m")} kg
TendÃªncia do peso (3 meses): ${val("tendenciaPeso")}
Obs. (tendÃªncia): ${val("motivoVariacaoPeso")}
WhatsApp do aluno: ${val("whatsAluno")}
Cidade/Estado: ${val("cidadeAluno")}

ğŸ¯ OBJETIVO / METABOLISMO
Objetivo principal: ${val("objetivo")}
Prazo/meta: ${val("prazoMeta")}
Metabolismo (auto): ${mfit_classificar_metabolismo()}
NÃ­vel de atividade fora da academia: ${ (computeAtividadeAuto().label || val("atividade")) }
Passos/dia (mÃ©dia): ${val("passosDia")}
Cardio extra: ${val("cardioExtra")}
Treino (dias): ${val("treinoDias") || "-"} | HorÃ¡rio: ${val("treinoHorario") || "-"}

ğŸ§  ESTRATÃ‰GIA MFIT (AUTOMÃTICA â€” ADERÃŠNCIA)
Maior gargalo: ${val("maiorDificuldade")}${val("maiorDificuldade")==="Outro"&&val("dificuldadeOutro")?(" â€” "+val("dificuldadeOutro")):""}
Fome predominante: ${val("fomePeriodos")} | CompulsÃ£o: ${val("compulsao")}
${computeStrategyText()}


â° ROTINA
Acorda: ${val("acorda")}
Dorme: ${val("dorme")}
CafÃ© da manhÃ£ (horÃ¡rio): ${val("cafeHorario")}
AlmoÃ§o (horÃ¡rio): ${val("almocoHorario")}
Jantar (horÃ¡rio): ${val("jantarHorario")}
Faz lanches entre refeiÃ§Ãµes?: ${val("lanches")}
RefeiÃ§Ãµes por dia: ${val("refeicoesDia")}
Tempo pra preparar comida: ${val("tempoPreparo")}
Custo da dieta: ${val("custoDieta")}

ğŸ“¦ LOGÃSTICA
Onde compra: ${val("localCompras")}
FrequÃªncia de compras: ${val("frequenciaCompras")}
Geladeira/freezer: ${val("temGeladeira")}
Consegue marmitas: ${val("podeMarmita")}
HorÃ¡rios fixos: ${val("horariosFixos")}

ğŸ½ ESTILO / PREFERÃŠNCIAS
Estilo alimentar: ${val("estiloAlimentar")}
Detalhe estilo (outro): ${val("estiloOutro")}
Gosta muito de:
${val("gosta")}
NÃ£o come / nÃ£o gosta:
${val("naoGosta")}
PossÃ­veis restriÃ§Ãµes: ${joinChecks(".rest")}${val("restOutro")?(" | Outro: "+val("restOutro")):""}
Alergias: ${val("alergias")}

ğŸ³ ACEITO COMER (CafÃ© / Lanches)
${listSelectedPretty("cafeGrid")}

ğŸ› ACEITO COMER (AlmoÃ§o / Jantar)
${listSelectedPretty("almocoGrid")}

ğŸ¥ª ACEITO COMER (Snacks)
${listSelectedPretty("snackGrid")}

ğŸ©º SAÃšDE / EXAMES
Exames recentes: ${val("exames")}
AlteraÃ§Ãµes nos exames: ${val("alteracoes")}
Medicamentos contÃ­nuos: ${val("medic")}
HistÃ³rico familiar: ${joinChecks(".hist")}

ğŸ’Š SUPLEMENTAÃ‡ÃƒO
JÃ¡ usa suplemento?: ${val("usaSup")}
Quais suplementos usa: ${val("quaisSup")}
Quer suplemento no plano?: ${val("incluirSup")}

ğŸ’§ HIDRATAÃ‡ÃƒO
Ãgua por dia: ${val("agua")}

ğŸ§  ESTILO DE VIDA
Ãlcool: ${val("alcool")}
Fuma: ${val("fuma")}
CafeÃ­na/estimulantes: ${val("cafeinaConsumo")}
Ãšltimo horÃ¡rio de cafeÃ­na: ${val("cafeinaUltimoHorario")}
Obs. cafeÃ­na: ${val("cafeinaObservacao")}
NÃ­vel de estresse: ${val("estresse")}
Dorme bem?: ${val("sonoQualidade")}
Horas de sono (mÃ©dia): ${val("sonoHoras")}
Fast food / doce / refri: ${val("lixo")}
PerÃ­odo de maior fome: ${val("fomePeriodos")}
Ansiedade/compulsÃ£o: ${val("compulsao")}
DigestÃ£o (obs.): ${val("digestaoObs")}

ğŸ“ RECORDATÃ“RIO 24H (opcional)
${val("recordatorio24h")}

âš  ObservaÃ§Ã£o final
Pronto para gerar DIETA MFIT PRETO/VERDE com opÃ§Ãµes por refeiÃ§Ã£o, quantidades (g/ml), hidrataÃ§Ã£o e suplementaÃ§Ã£o personalizada.`;
    return texto;
  }

  // ====== Enviar no WhatsApp ======
  // ====== MFIT: Auto-atividade (Passos + Cardio) + EstratÃ©gia por Dificuldade ======
function parseCardioInfo(raw){
  const s = (raw||"").toLowerCase().trim();
  if(!s) return {has:false, freq:0, mins:0, saysNo:false};
  if(/(nÃ£o|nao)\s*(faÃ§o|faco|faÃ§o)/.test(s) || /nÃ£o faÃ§o|nao faco|nao faÃ§o|nÃ£o faco/.test(s) || /^nao$|^nÃ£o$/.test(s)){
    return {has:false, freq:0, mins:0, saysNo:true};
  }
  // freq: tries to read "3x", "3x/sem", "3 vezes", "3x semana"
  let freq = 0
  const m1 = s.match(/(\d+)\s*x\s*(\/\s*sem|sem|semana|\/\s*semana)?/);
  const m2 = s.match(/(\d+)\s*(vez|vezes)\s*(por|\/)?\s*(sem|semana)?/);
  if(m1) freq = parseInt(m1[1],10) || 0;
  else if(m2) freq = parseInt(m2[1],10) || 0;

  // minutes: "25 min", "30min", "0:30"
  let mins = 0;
  const mm = s.match(/(\d{1,3})\s*min/);
  if(mm) mins = parseInt(mm[1],10) || 0;
  const mt = s.match(/\b(\d{1,2})\s*:\s*(\d{2})\b/);
  if(mt){
    mins = (parseInt(mt[1],10)||0)*60 + (parseInt(mt[2],10)||0);
  }
  const has = !(/nÃ£o|nao/.test(s)) && (freq>0 || mins>0 || /caminhada|corrida|bike|bicicleta|esteira|hiit|nataÃ§Ã£o|natacao|corda/.test(s));
  return {has, freq, mins, saysNo:false};
}

function computeAtividadeAuto(){
  const passosRaw = val("passosDia");
  const passos = passosRaw ? parseInt(passosRaw, 10) : NaN;
  const cardio = parseCardioInfo(val("cardioExtra"));

  // Base por passos
  let level = ""; // "Leve" | "Moderado" | "Intenso"
  if(!Number.isNaN(passos)){
    if(passos < 5000) level = "Leve";
    else if(passos < 9000) level = "Moderado";
    else level = "Intenso";
  }

  // Ajuste por cardio (sobe 1 nÃ­vel se houver cardio "relevante")
  const cardioRelevant = cardio.has && ( (cardio.freq>=3 && cardio.mins>=20) || (cardio.freq>=4) || (cardio.mins>=30) );
  if(level && cardioRelevant){
    if(level === "Leve") level = "Moderado";
    else if(level === "Moderado") level = "Intenso";
  }

  // Se nÃ£o deu para calcular, cai no manual
  if(!level){
    const manual = (val("atividade")||"").trim();
    if(/Leve/i.test(manual)) return {label: manual, auto:false};
    if(/Moderado/i.test(manual)) return {label: manual, auto:false};
    if(/Intenso/i.test(manual)) return {label: manual, auto:false};
    return {label: "", auto:false};
  }

  const pretty =
    (level==="Leve") ? "Leve (auto â€” passos/cardio)" :
    (level==="Moderado") ? "Moderado (auto â€” passos/cardio)" :
    "Intenso (auto â€” passos/cardio)";

  return {label: pretty, auto:true, level};
}

function applyAtividadeSuggestion(){
  // Apenas sugere/auto-preenche se o campo manual estiver vazio
  const manual = (val("atividade")||"").trim();
  if(manual) return;
  const auto = computeAtividadeAuto();
  if(!auto.label) return;

  // Mapear para uma opÃ§Ã£o do select
  const sel = $("atividade");
  if(!sel) return;
  const opts = Array.from(sel.options || []);
  const target =
    auto.level==="Leve" ? opts.find(o=>/^Leve/i.test(o.textContent.trim())) :
    auto.level==="Moderado" ? opts.find(o=>/^Moderado/i.test(o.textContent.trim())) :
    opts.find(o=>/^Intenso/i.test(o.textContent.trim()));
  if(target){
    sel.value = target.textContent.trim();
    save();
  }
}

function computeStrategyText(){
  const dif = (val("maiorDificuldade")||"").trim();
  const difOutro = (val("dificuldadeOutro")||"").trim();
  const fome = (val("fomePeriodos")||"").trim();
  const comp = (val("compulsao")||"").trim();
  const cardioTxt = (val("cardioExtra")||"").trim();

  let lines = [];

  function add(s){ if(s) lines.push("â€¢ " + s); }

  // Dificuldade principal
  if(/OrganizaÃ§Ã£o|preparo/i.test(dif)){
    add("Plano de preparo semanal: 2â€“3 bases de proteÃ­na + 2 carboidratos + vegetais prontos para 3â€“4 dias.");
    add("Montagem rÃ¡pida: proteÃ­na + carbo + salada (porÃ§Ã£o medida) â€” evita decisÃµes no dia.");
    add("Lanches portÃ¡teis: iogurte zero, ovos cozidos, shake (quando necessÃ¡rio).");
  }else if(/Fome/i.test(dif) || /Noite/i.test(fome)){
    add("Distribuir maior volume e saciedade no fim do dia: vegetais + proteÃ­na no jantar e ceia planejada.");
    add("Carboidrato estrategicamente no jantar/pÃ³s-treino (se aplicÃ¡vel) para reduzir fome noturna.");
    add("Evitar longos perÃ­odos sem comer: 3â€“5 refeiÃ§Ãµes com proteÃ­na em todas.");
  }else if(/Ansiedade|compuls/i.test(dif) || /Frequente/i.test(comp)){
    add("Estrutura rÃ­gida de horÃ¡rios + proteÃ­na alta por refeiÃ§Ã£o para reduzir gatilhos de belisco.");
    add("Trocar 'gatilhos' por alternativas: iogurte zero, frutas da semana, Ã¡gua com gÃ¡s/chÃ¡; doce sÃ³ planejado.");
    add("Sono e cafeÃ­na: evitar cafeÃ­na apÃ³s 16:00 quando houver fome/compulsÃ£o Ã  noite.");
  }else if(/Rotina|horÃ¡rios/i.test(dif)){
    add("EstratÃ©gia de 'refeiÃ§Ã£o mÃ³vel': 1â€“2 lanches prontos (shake/atum/ovos) para nÃ£o pular refeiÃ§Ãµes.");
    add("RefeiÃ§Ãµes Ã¢ncora: cafÃ© + almoÃ§o + jantar fixos; lanches ajustam a meta do dia.");
  }else if(/Financeiro/i.test(dif)){
    add("Base econÃ´mica: ovos, moela/coraÃ§Ã£o, sardinha, frango, arroz, macarrÃ£o, cuscuz, feijÃ£o/lentilha.");
    add("Regra de troca: manter a mesma gramatura da proteÃ­na do plano; fÃ­gado 1â€“2x/semana.");
    add("Comprar 2â€“3 frutas/vegetais mais baratos da semana para volume e micronutrientes.");
  }else if(/Social|famÃ­lia|eventos/i.test(dif)){
    add("EstratÃ©gia 80/20: manter 80% do plano e reservar 1 refeiÃ§Ã£o social planejada/semana.");
    add("Antes do evento: proteÃ­na + salada; no evento: 1 prato, 1 sobremesa pequena, sem beliscar.");
  }else if(dif === "Outro" && difOutro){
    add("Dificuldade (outro): " + difOutro + " â€” ajustar distribuiÃ§Ã£o e escolhas para aderÃªncia mÃ¡xima.");
  }

  // Complementos por fome/compulsÃ£o
  if(fome && /Madrugada/i.test(fome)){
    add("Ceia obrigatÃ³ria (proteÃ­na + fibra) e rotina de desligamento 60â€“90 min antes de dormir.");
  }
  if(cardioTxt && !/(nÃ£o|nao)/i.test(cardioTxt)){
    add("Cardio extra informado: ajustar carboidratos e estratÃ©gia de recuperaÃ§Ã£o para evitar fome reativa.");
  }

  if(!lines.length){
    add("Sem gargalo principal marcado: manter plano padrÃ£o com consistÃªncia e ajustes semanais.");
  }

  return lines.join("\n");
}

function validateForm(){
  const missing = [];
  const push = (label, id) => missing.push({label, id});

  // Base de geraÃ§Ã£o
  if(!val("objetivo")) push("Objetivo (SeÃ§Ã£o 1)", "objetivo");
  if(!val("prazoMeta")) push("Prazo/meta (SeÃ§Ã£o 1)", "prazoMeta");

  // Ajuste de gasto
  const passos = val("passosDia");
  if(!passos) push("Passos/dia (SeÃ§Ã£o 2)", "passosDia");
  if(!val("cardioExtra")) push("Cardio extra (SeÃ§Ã£o 2) â€” escreva 'nÃ£o faÃ§o' se nÃ£o fizer", "cardioExtra");

  // Treino
  if(!val("treinoDias")) push("Treino (dias) (SeÃ§Ã£o 2)", "treinoDias");

  // AderÃªncia / estratÃ©gia
  if(!val("maiorDificuldade")) push("Maior dificuldade (SeÃ§Ã£o 9)", "maiorDificuldade");
  if(!val("fomePeriodos")) push("PerÃ­odo de maior fome (SeÃ§Ã£o 3.1)", "fomePeriodos");
  if(!val("compulsao")) push("Ansiedade/compulsÃ£o (SeÃ§Ã£o 3.1)", "compulsao");

  // horÃ¡rio de treino (HH:MM)
const th = $("treinoHorario");
if(th && th.value && !isHHMM(th.value)){
  missing.push("HorÃ¡rio do treino (HH:MM)");
}

if(missing.length){

    const msg =
      "Faltou preencher:\n\n" +
      missing.map((m,i)=>`${i+1}) ${m.label}`).join("\n") +
      "\n\nPreencha e tente novamente.";
    alert(msg);
    // foca o primeiro campo faltante
    const first = missing[0];
    const el = $(first.id);
    if(el && el.scrollIntoView){
      el.scrollIntoView({behavior:"smooth", block:"center"});
      try{ el.focus(); }catch(e){}
    }
    return false;
  }
  return true;
}

function sendWhatsApp(){
    if(!validateForm()){
      $("err").style.display="block";
      $("ok").style.display="none";
      return;
    }
    $("err").style.display="none";

    save();
    const text = buildMessage();
    const url = "https://api.whatsapp.com/send?phone=" + phone + "&text=" + encodeURIComponent(text);

    let opened = false;
    try{
      const win = window.open(url, "_blank");
      if(win && typeof win.focus==="function"){
        win.focus();
        opened = true;
      }
    }catch(e){}

    if(!opened){
      try{
        window.location.href = url;
        opened = true;
      }catch(e){}
    }

    $("ok").style.display="block";
  }

  // ====== Copiar mensagem manual (iPhone etc.) ======
  async function copyMessage(){
    if(!validateForm()){
      return;
    }
    const text = buildMessage() + "\\n\\nEnviar para: https://wa.me/" + phone;
    try{
      await navigator.clipboard.writeText(text);
      alert("Mensagem copiada! Abra o WhatsApp e cole no chat do Personal MFIT ğŸ’š");
    }catch(e){
      const ta=document.createElement('textarea');
      ta.value=text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert("Se nÃ£o copiou automÃ¡tico, selecione e copie manualmente.");
    }
  }

  // ====== Listeners / init ======
  // HH:MM helper (evita time-picker gigante no Android)
function formatHHMM(v){
  const digits = (v||"").replace(/\D/g,"").slice(0,4);
  if(digits.length<=2) return digits;
  return digits.slice(0,2)+":"+digits.slice(2);
}
function isHHMM(v){
  return /^([01]\d|2[0-3]):[0-5]\d$/.test((v||"").trim());
}

function attachListeners(){
    fields.forEach(f=>{
      const el=$(f);
      if(el){
        el.addEventListener("input", save);
        el.addEventListener("change", save);
      
// Biotipo visual: tabs + seleÃ§Ã£o (override opcional)
function paintBioSelection(){
  const mv = (val("metVisual")||"").trim();
  document.querySelectorAll("#secBiotipoVisual .bio-card").forEach(c=>{
    c.classList.toggle("selected", mv && c.getAttribute("data-meta")==mv);
  });
}
}

function initBiotipoVisual(){
  const wrap = document.getElementById("bioGrid");
  const hidden = document.getElementById("metVisual");
  if(!wrap || !hidden) return;

  // SeleÃ§Ã£o inicial (se houver valor jÃ¡ preenchido)
  paintBioSelection();

  // Clique/seleÃ§Ã£o
  wrap.querySelectorAll(".bio-card").forEach(card=>{
    card.addEventListener("click", ()=>{
      const meta = card.getAttribute("data-meta") || "";
      hidden.value = meta;
      paintBioSelection();
    });
  });

  // Se o valor for ajustado por script, repinta
  hidden.addEventListener("change", paintBioSelection);
}
initBiotipoVisual();
  }
    });

    Array.from(document.querySelectorAll('.rest,.hist')).forEach(x=>{
      x.addEventListener("change", save);
    });

// Auto-sugestÃ£o: atividade diÃ¡ria (Passos + Cardio)
["passosDia","cardioExtra"].forEach(id=>{
  const el=$(id);
  if(el){
    el.addEventListener("input", ()=>{
      applyAtividadeSuggestion();
    });
    el.addEventListener("change", ()=>{
      applyAtividadeSuggestion();
    });
  }
});

    ["met1","met2","met3","met4","met5"].forEach(id=>{
      const el=$(id);
      if(el){
        el.addEventListener("change", ()=>{
          mfit_classificar_metabolismo();
          save();
        });
      }
    });
  }

  setupFoodGrid("cafeGrid");
  setupFoodGrid("almocoGrid");
  setupFoodGrid("snackGrid");
  setupFoodGrid("bebidasGrid");

  load();
  attachListeners();
  try{ mfit_classificar_metabolismo(); applyAtividadeSuggestion(); refreshPreview(); refreshDayPlan(); }catch(e){}

  $("sendBtn").addEventListener("click", sendWhatsApp);
  $("copyBtn2").addEventListener("click", copyMessage);
</script>
<script>
// === MFIT: lÃ³gica Metabolismo Ã— Objetivo (Guia dinÃ¢mico) ===
(function(){
  // Helpers
  function byId(id){ return document.getElementById(id); }
  function valByIdOrName(key){
    const el = byId(key);
    if(el){
      if(el.tagName === 'SELECT' || el.tagName === 'INPUT' || el.tagName === 'TEXTAREA'){
        return el.value;
      }
      return el.textContent.trim();
    }
    // procura por [name=key]
    const byName = document.querySelector(`[name="${key}"]:checked`) || document.querySelector(`[name="${key}"]`);
    if(byName){
      if(byName.type === 'radio'){
        const checked = document.querySelectorAll(`[name="${key}"]:checked`);
        if(checked && checked[0]) return checked[0].value;
      }
      return byName.value || byName.textContent || '';
    }
    return '';
  }

  // Metabolism classifier: try existing; fallback to custom
  function getMeta(){
    const mv = valByIdOrName("metVisual");
    if(mv && mv.trim()){ return mv.trim(); }

    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    // fallback: look for select#metabolismo, #metabox, or name="metabolismo"
    let meta = valByIdOrName('metabolismo') || valByIdOrName('metabox');
    meta = meta || 'Mesomorfo';
    return meta;
  }

  function getObj(){
    let obj = valByIdOrName('objetivo');
    if(!obj || obj==='') {
      // fallback: tenta alguns rÃ³tulos comuns
      const cand = document.querySelector('#objetivo, [name="objetivo"], #objetivoPrincipal, [name="objetivoPrincipal"]');
      if(cand){
        obj = cand.value || cand.textContent || '';
      }
    }
    return obj || 'Emagrecimento / DefiniÃ§Ã£o corporal';
  }

  const META_DESC = {
    "Ectomorfo": "Magro, perde peso fÃ¡cil. Precisa de mais calorias e bastante carboidrato de qualidade; manter proteÃ­na adequada.",
    "Mesomorfo": "IntermediÃ¡rio. Responde bem com equilÃ­brio entre carbo, proteÃ­na e gordura boa; foco em porÃ§Ãµes corretas.",
    "Endomorfo": "Ganha peso fÃ¡cil. Beneficia de carbo menor, alta proteÃ­na, fibras e gorduras boas; evitar refinados."
  };

  const OBJ_DESC = {
    "Emagrecimento / DefiniÃ§Ã£o corporal": "Calorias controladas, proteÃ­na alta, carbo de qualidade em porÃ§Ãµes medidas, cortar aÃ§Ãºcar e ultraprocessados.",
    "Ganho de massa muscular (hipertrofia)": "SuperÃ¡vit calÃ³rico leve, carbo elevado e proteÃ­na suficiente; refeiÃ§Ãµes densas e consistentes.",
    "SaÃºde / Emagrecimento": "AlimentaÃ§Ã£o limpa e balanceada; foco em legumes, frutas, grÃ£os e carnes magras; reduzir ultraprocessados."
  };

  // Listas base
  const BASE = {
    ovos:"Ovos",
    iogurte:"Iogurte / leite desnatado",
    frutas:"Frutas variadas",
    aveia:"Aveia / farelo de aveia",
    pao:"PÃ£o integral",
    tapioca:"Tapioca",
    arroz:"Arroz (pref. integral no corte)",
    macarrao:"MacarrÃ£o (pref. integral)",
    batata:"Batata doce / mandioca",
    feijao:"FeijÃ£o / leguminosas",
    frango:"Frango",
    peixe:"Peixe / TilÃ¡pia",
    patinho:"Patinho / carnes magras",
    salada:"Salada / Legumes",
    wrap:"Rap10 / Wrap",
    sanduiche:"SanduÃ­che natural (frango/atum)",
    shake:"Shake / vitamina",
    oleaginosas:"Oleaginosas (amendoim, castanhas)",
    ultra:"Ultraprocessados, frituras, refrigerantes, doces (evitar)"
  };

  // CombinaÃ§Ãµes Objetivo Ã— Metabolismo
  const RULES = {
    "Emagrecimento / DefiniÃ§Ã£o corporal": {
      "Ectomorfo": {
        yes:[BASE.ovos,BASE.frutas,BASE.aveia,BASE.pao,BASE.tapioca,BASE.arroz,BASE.macarrao,BASE.frango,BASE.patinho,BASE.peixe,BASE.feijao,BASE.salada,BASE.batata],
        no:[BASE.ultra]
      },
      "Mesomorfo": {
        yes:[BASE.ovos,BASE.aveia,BASE.frutas,BASE.iogurte,BASE.frango,BASE.peixe,BASE.patinho,BASE.arroz,BASE.feijao,BASE.salada,BASE.batata],
        no:[BASE.macarrao,BASE.shake,BASE.oleaginosas,BASE.ultra]
      },
      "Endomorfo": {
        yes:[BASE.ovos,BASE.iogurte,BASE.frutas,BASE.frango,BASE.peixe,BASE.patinho,BASE.salada,BASE.batata,BASE.arroz,BASE.feijao],
        no:[BASE.pao,BASE.tapioca,BASE.macarrao,BASE.shake,BASE.ultra]
      }
    },
    "Ganho de massa muscular (hipertrofia)": {
      "Ectomorfo": {
        yes:[BASE.pao,BASE.aveia,BASE.tapioca,BASE.arroz,BASE.macarrao,BASE.frutas,BASE.shake,BASE.wrap,BASE.frango,BASE.patinho,BASE.peixe,BASE.feijao,BASE.salada],
        no:[BASE.oleaginosas,BASE.ultra] // moderar gordura p/ caber mais carbo
      },
      "Mesomorfo": {
        yes:[BASE.aveia,BASE.frutas,BASE.arroz,BASE.feijao,BASE.macarrao,BASE.frango,BASE.patinho,BASE.peixe,BASE.salada,BASE.batata],
        no:[BASE.ultra]
      },
      "Endomorfo": {
        yes:[BASE.ovos,BASE.iogurte,BASE.frutas,BASE.arroz,BASE.feijao,BASE.batata,BASE.frango,BASE.patinho,BASE.peixe,BASE.salada],
        no:[BASE.macarrao,BASE.tapioca,BASE.pao,BASE.shake,BASE.ultra]
      }
    },
    "SaÃºde / Emagrecimento": {
      "Ectomorfo": {
        yes:[BASE.arroz,BASE.feijao,BASE.aveia,BASE.frutas,BASE.frango,BASE.peixe,BASE.patinho,BASE.salada,BASE.batata],
        no:[BASE.ultra]
      },
      "Mesomorfo": {
        yes:[BASE.arroz,BASE.feijao,BASE.aveia,BASE.frutas,BASE.frango,BASE.peixe,BASE.patinho,BASE.salada,BASE.batata],
        no:[BASE.ultra]
      },
      "Endomorfo": {
        yes:[BASE.ovos,BASE.iogurte,BASE.frutas,BASE.frango,BASE.peixe,BASE.patinho,BASE.salada,BASE.batata,BASE.feijao],
        no:[BASE.pao,BASE.macarrao,BASE.tapioca,BASE.ultra]
      }
    }
  };

  function renderList(ul, items){
    if(!ul) return;
    ul.innerHTML='';
    (items||[]).forEach(t=>{
      const li=document.createElement('li'); li.textContent=t; ul.appendChild(li);
    });
  }

  function updateGuide(){
    const meta = getMeta();
    const obj = getObj();
    const metaDesc = META_DESC[meta] || '';
    const objDesc = OBJ_DESC[obj] || '';

    const pack = (RULES[obj] && RULES[obj][meta]) ? RULES[obj][meta] : {yes:[], no:[]};

    const metaBox = byId('mfit-meta-desc');
    const objBox = byId('mfit-obj-desc');
    const yesUl = byId('mfit-food-yes');
    const noUl = byId('mfit-food-no');

    if(metaBox) metaBox.innerHTML = `<span class="pill">${meta}</span> â€” ${metaDesc}`;
    if(objBox) objBox.innerHTML = `<span class="pill">${obj}</span> â€” ${objDesc}`;
    renderList(yesUl, pack.yes);
    renderList(noUl, pack.no);
  }

  // Try to place the panel near existing objective/metabolism fields
  function ensurePanel(){
    if(document.getElementById('mfit-guide')) return;
    const host = document.querySelector('#guiaMetaObjetivo') || document.querySelector('#guia-meta-objetivo') || document.body;
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `\n<section id=\"mfit-guide\" aria-live=\"polite\">\n  <h3>Guia rÃ¡pido: Metabolismo Ã— Objetivo</h3>\n  <div class=\"row\">\n    <div>\n      <div class=\"muted\">Resumo do metabolismo</div>\n      <div id=\"mfit-meta-desc\"></div>\n    </div>\n    <div>\n      <div class=\"muted\">Foco pelo objetivo</div>\n      <div id=\"mfit-obj-desc\"></div>\n    </div>\n  </div>\n  <hr style=\"border:none;border-top:1px solid #1e1e1e;margin:12px 0\" />\n  <div class=\"row\">\n    <div>\n      <div class=\"muted\">Alimentos indicados</div>\n      <ul id=\"mfit-food-yes\" class=\"list\"></ul>\n    </div>\n    <div>\n      <div class=\"muted\">Limitar / evitar</div>\n      <ul id=\"mfit-food-no\" class=\"list\"></ul>\n    </div>\n  </div>\n  <div class=\"muted\" style=\"margin-top:10px;font-size:.95rem\">As recomendaÃ§Ãµes se ajustam automaticamente quando vocÃª responde <b>Metabolismo</b> e <b>Objetivo</b> no formulÃ¡rio.</div>\n</section>\n`;
    host.appendChild(wrapper.firstElementChild);
  }

  function attachListeners(){
    const ids = ['objetivo','metabolismo','metabox','met1','met2','met3','met4','met5'];
    ids.forEach(id=>{
      const el = byId(id) || document.querySelector(`[name="${id}"]`);
      if(!el) return;
      el.addEventListener('change', updateGuide, {passive:true});
      el.addEventListener('input', updateGuide, {passive:true});
    });
  }

  // init
  ensurePanel();
  attachListeners();
  updateGuide();
})();
</script>
<script>
// === MFIT: marcaÃ§Ã£o visual de cards de alimentos ===
(function(){
  function norm(s){
    if(!s) return "";
    return s.toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
  }
  function byId(id){ return document.getElementById(id); }
  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
      return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){
    return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal';
  }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || valField('metabox') || 'Mesomorfo';
  }

  const K = {
    ovos: ["ovo","ovos"],
    iogurte:["iogurte","leite desnatado"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango"],
    aveia:["aveia","farelo"],
    pao:["pao integral","pao","integral"],
    tapioca:["tapioca"],
    arroz:["arroz"],
    macarrao:["macarrao","massa","espaguete","parafuso","penne","talharim"],
    batata:["batata doce","mandioca","aipim","inhame"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico"],
    frango:["frango","peito de frango"],
    peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"],
    salada:["salada","legume","alface","tomate","pepino","brocolis","cenoura","abobrinha","berinjela","brÃ³colis"],
    wrap:["rap10","wrap","tortilha"],
    sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"],
    oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas"]
  };

  const RULES_KEYS = {
    "Emagrecimento / DefiniÃ§Ã£o corporal": {
      "Ectomorfo": { yes:["ovos","frutas","aveia","pao","tapioca","arroz","macarrao","frango","patinho","peixe","feijao","salada","batata"], no:["oleaginosas","shake"] },
      "Mesomorfo": { yes:["ovos","aveia","frutas","iogurte","frango","peixe","patinho","arroz","feijao","salada","batata"], no:["macarrao","shake","oleaginosas"] },
      "Endomorfo": { yes:["ovos","iogurte","frutas","frango","peixe","patinho","salada","batata","arroz","feijao"], no:["pao","tapioca","macarrao","shake","oleaginosas"] }
    },
    "Ganho de massa muscular (hipertrofia)": {
      "Ectomorfo": { yes:["pao","aveia","tapioca","arroz","macarrao","frutas","shake","wrap","frango","patinho","peixe","feijao","salada"], no:["oleaginosas"] },
      "Mesomorfo": { yes:["aveia","frutas","arroz","feijao","macarrao","frango","patinho","peixe","salada","batata"], no:[] },
      "Endomorfo": { yes:["ovos","iogurte","frutas","arroz","feijao","batata","frango","patinho","peixe","salada"], no:["macarrao","tapioca","pao","shake","oleaginosas"] }
    },
    "SaÃºde / Emagrecimento": {
      "Ectomorfo": { yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","salada","batata"], no:["oleaginosas","shake"] },
      "Mesomorfo": { yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","salada","batata"], no:["shake","oleaginosas"] },
      "Endomorfo": { yes:["ovos","iogurte","frutas","frango","peixe","patinho","salada","batata","feijao"], no:["pao","macarrao","tapioca","shake","oleaginosas"] }
    }
  };

  function getCardName(card){
    const dv = card.getAttribute('data-value');
    if(dv) return dv;
    const t = card.querySelector('.title, .name, .food-name');
    return (t ? t.textContent : card.textContent || '').trim();
  }

  function matchesAny(name, keys){
    const n = norm(name);
    return keys.some(k => n.includes(norm(k)));
  }

  function markFoodCards(){
    const obj = getObj();
    const meta = getMeta();
    const pack = (RULES_KEYS[obj] && RULES_KEYS[obj][meta]) ? RULES_KEYS[obj][meta] : null;
    const all = document.querySelectorAll('.food-card');
    all.forEach(c => {
      c.classList.remove('recommended','dim');
      if(!pack) return;
      const name = getCardName(c);
      const yesKeys = (pack.yes||[]).flatMap(k => K[k] || []);
      const noKeys  = (pack.no ||[]).flatMap(k => K[k] || []);
      if(yesKeys.length && matchesAny(name, yesKeys)) c.classList.add('recommended');
      if(noKeys.length  && matchesAny(name, noKeys))  c.classList.add('dim');
    });
  }

  const ids = ['objetivo','metabolismo','metabox','met1','met2','met3','met4','met5'];
  ids.forEach(id=>{
    const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
    if(el){
      el.addEventListener('change', markFoodCards, {passive:true});
      el.addEventListener('input', markFoodCards, {passive:true});
    }
  });

  window.mfit_markFoodCards = markFoodCards;
  setTimeout(markFoodCards, 0);
})();
</script>
<section id="mfit-food-auto">
<h3>Alimentos sugeridos para vocÃª</h3>
<div class="mfit-final-grid">
<div class="mfit-panel">
<h4>Sua seleÃ§Ã£o</h4>
<div id="mfit-chosen"></div>
<div class="mfit-note">Marque/desmarque aqui ou nos cards acima.</div>
</div>
<div class="mfit-panel">
<h4>Sugeridos (permitidos)</h4>
<div id="mfit-allowed"></div>
<div class="mfit-note">OpÃ§Ãµes alinhadas ao seu <b>metabolismo</b> e <b>objetivo</b>.</div>
</div>
<div class="mfit-panel">
<h4>Bloqueados para seu perfil</h4>
<div id="mfit-blocked"></div>
<div class="mfit-note">Esses nÃ£o entram na seleÃ§Ã£o.</div>
</div>
</div>
</section>
<script>
// === MFIT: seÃ§Ã£o final auto de alimentos sugeridos ===
(function(){
  function byId(id){ return document.getElementById(id); }
  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
      return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){
    return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal';
  }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || valField('metabox') || 'Mesomorfo';
  }

  // Reusa mapeamento do script anterior se existir no escopo global
  const RULES_KEYS = (function(){
    // Pega do escopo da pÃ¡gina se jÃ¡ definido
    if(window.__MFIT_RULES_KEYS__) return window.__MFIT_RULES_KEYS__;
    // Caso nÃ£o, define rapidamente um igual ao do mÃ³dulo dos cards
    return {
      "Emagrecimento / DefiniÃ§Ã£o corporal": {
        "Ectomorfo": { yes:["ovos","frutas","aveia","pao","tapioca","arroz","macarrao","frango","patinho","peixe","feijao","salada","batata"], no:["oleaginosas","shake"] },
        "Mesomorfo": { yes:["ovos","aveia","frutas","iogurte","frango","peixe","patinho","arroz","feijao","salada","batata"], no:["macarrao","shake","oleaginosas"] },
        "Endomorfo": { yes:["ovos","iogurte","frutas","frango","peixe","patinho","salada","batata","arroz","feijao"], no:["pao","tapioca","macarrao","shake","oleaginosas"] }
      },
      "Ganho de massa muscular (hipertrofia)": {
        "Ectomorfo": { yes:["pao","aveia","tapioca","arroz","macarrao","frutas","shake","wrap","frango","patinho","peixe","feijao","salada"], no:["oleaginosas"] },
        "Mesomorfo": { yes:["aveia","frutas","arroz","feijao","macarrao","frango","patinho","peixe","salada","batata"], no:[] },
        "Endomorfo": { yes:["ovos","iogurte","frutas","arroz","feijao","batata","frango","patinho","peixe","salada"], no:["macarrao","tapioca","pao","shake","oleaginosas"] }
      },
      "SaÃºde / Emagrecimento": {
        "Ectomorfo": { yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","salada","batata"], no:["oleaginosas","shake"] },
        "Mesomorfo": { yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","salada","batata"], no:["shake","oleaginosas"] },
        "Endomorfo": { yes:["ovos","iogurte","frutas","frango","peixe","patinho","salada","batata","feijao"], no:["pao","macarrao","tapioca","shake","oleaginosas"] }
      }
    };
  })();

  // DicionÃ¡rio rÃ³tulos bonitos para as chaves
  const LABELS = {
    ovos:"Ovos",
    iogurte:"Iogurte / Leite desnatado",
    frutas:"Frutas",
    aveia:"Aveia",
    pao:"PÃ£o integral",
    tapioca:"Tapioca",
    arroz:"Arroz",
    macarrao:"MacarrÃ£o",
    batata:"Batata doce / Mandioca",
    feijao:"FeijÃ£o / Leguminosas",
    frango:"Frango",
    peixe:"Peixe / TilÃ¡pia",
    patinho:"Patinho / Carne magra",
    salada:"Salada / Legumes",
    wrap:"Rap10 / Wrap",
    sanduiche:"SanduÃ­che natural",
    shake:"Shake / vitamina",
    oleaginosas:"Oleaginosas"
  };

  function renderChips(container, keys, limit=false){
    if(!container) return;
    container.innerHTML = '';
    (keys||[]).forEach(k => {
      const label = LABELS[k] || k;
      const id = 'chip_'+k;
      const wrap = document.createElement('label');
      wrap.className = 'mfit-chip' + (limit ? ' limit' : '');
      wrap.innerHTML = `<input type="checkbox" checked id="${id}" /> ${label}`;
      container.appendChild(wrap);
    });
  }

  function updateAutoFoods(){
    const meta = getMeta();
    const obj = getObj();
    const pack = (RULES_KEYS[obj] && RULES_KEYS[obj][meta]) ? RULES_KEYS[obj][meta] : {yes:[], no:[]};
    renderChips(document.getElementById('mfit-food-auto-yes'), pack.yes, false);
    renderChips(document.getElementById('mfit-food-auto-no'), pack.no, true);

    // Opcional: sincroniza com cards existentes (.food-card)
    if(typeof window.mfit_markFoodCards === 'function'){
      window.mfit_markFoodCards();
    }
  }

  // Oculta seletor manual de metabolismo se o teste existir
  try{
    if(typeof mfit_classificar_metabolismo === 'function'){
      const manual = document.getElementById('metabox');
      if(manual){ manual.closest('.card')?.classList.add('hidden'); manual.style.display='none'; }
    }
  }catch(e){}

  // Gatilhos
  ['objetivo','metabolismo','metabox','met1','met2','met3','met4','met5'].forEach(id=>{
    const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
    if(el){
      el.addEventListener('change', updateAutoFoods, {passive:true});
      el.addEventListener('input', updateAutoFoods, {passive:true});
    }
  });

  // Inicial
  setTimeout(updateAutoFoods, 0);
  window.mfit_updateAutoFoods = updateAutoFoods;
})();
</script>
<script>
// === MFIT: sincronizar chips â†’ gerador/cardÃ¡pio ===
(function(){
  function norm(s){
    if(!s) return "";
    return s.toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
  }
  // Mesmo dicionÃ¡rio de palavras-chave dos cards
  const K = {
    ovos: ["ovo","ovos"],
    iogurte:["iogurte","leite desnatado"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango"],
    aveia:["aveia","farelo"],
    pao:["pao integral","pao","integral"],
    tapioca:["tapioca"],
    arroz:["arroz"],
    macarrao:["macarrao","massa","espaguete","parafuso","penne","talharim"],
    batata:["batata doce","mandioca","aipim","inhame"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico"],
    frango:["frango","peito de frango"],
    peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"],
    salada:["salada","legume","alface","tomate","pepino","brocolis","cenoura","abobrinha","berinjela","brÃ³colis"],
    wrap:["rap10","wrap","tortilha"],
    sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"],
    oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas"]
  };

  // Mapa rÃ³tulo â†’ chave
  const LABEL2KEY = {
    "Ovos":"ovos",
    "Iogurte / Leite desnatado":"iogurte",
    "Frutas":"frutas",
    "Aveia":"aveia",
    "PÃ£o integral":"pao",
    "Tapioca":"tapioca",
    "Arroz":"arroz",
    "MacarrÃ£o":"macarrao",
    "Batata doce / Mandioca":"batata",
    "FeijÃ£o / Leguminosas":"feijao",
    "Frango":"frango",
    "Peixe / TilÃ¡pia":"peixe",
    "Patinho / Carne magra":"patinho",
    "Salada / Legumes":"salada",
    "Rap10 / Wrap":"wrap",
    "SanduÃ­che natural":"sanduiche",
    "Shake / vitamina":"shake",
    "Oleaginosas":"oleaginosas"
  };

  function getChipsSelected(){
    const yes = Array.from(document.querySelectorAll('#mfit-food-auto-yes .mfit-chip input[type="checkbox"]:checked')).map(el => el.parentElement.textContent.trim());
    const no  = Array.from(document.querySelectorAll('#mfit-food-auto-no  .mfit-chip input[type="checkbox"]:checked')).map(el => el.parentElement.textContent.trim());
    // Converte rÃ³tulos â†’ chaves
    const mapToKeys = arr => arr.map(lbl => LABEL2KEY[lbl]).filter(Boolean);
    return { yesKeys: mapToKeys(yes), noKeys: mapToKeys(no) };
  }

  // Interface pÃºblica para outros mÃ³dulos
  window.mfit_collectSelectedFoods = function(){
    const {yesKeys, noKeys} = getChipsSelected();
    return {
      indicados: yesKeys,
      limitar: noKeys
    };
  };

  // Tenta sincronizar com .food-card (selecionar/deselecionar)
  function syncToCards(){
    const {yesKeys, noKeys} = getChipsSelected();
    const yesWords = yesKeys.flatMap(k => K[k] || []);
    const noWords  = noKeys .flatMap(k => K[k] || []);

    function matchesAny(text, keys){
      const n = norm(text);
      return keys.some(k => n.includes(norm(k)));
    }
    function getName(card){
      const dv = card.getAttribute('data-value');
      if(dv) return dv;
      const t = card.querySelector('.title, .name, .food-name');
      return (t ? t.textContent : card.textContent || '').trim();
    }
    // EstratÃ©gia: marcar 'selected' nos recomendados, remover dos limitados
    document.querySelectorAll('.food-card').forEach(card => {
      const name = getName(card);
      const isYes = matchesAny(name, yesWords);
      const isNo  = matchesAny(name, noWords);
      // assume toggle por classe 'selected' + aria-pressed
      if(isYes){
        if(!card.classList.contains('selected')){
          card.classList.add('selected');
          card.setAttribute('aria-pressed','true');
        }
      }
      if(isNo){
        if(card.classList.contains('selected')){
          card.classList.remove('selected');
          card.setAttribute('aria-pressed','false');
        }
      }
    });

    // Chama hooks do seu gerador, se existirem
    try{ if(typeof save === 'function') save(); }catch(e){}
    try{ if(typeof refreshPreview === 'function') refreshPreview(); }catch(e){}
    try{ if(typeof refreshDayPlan === 'function') refreshDayPlan(); }catch(e){}
  }

  // BotÃ£o auxiliar (injetado no painel) para o usuÃ¡rio aplicar seleÃ§Ã£o automaticamente
  function ensureApplyButton(){
    if(document.getElementById('mfit-apply-chips')) return;
    const host = document.getElementById('mfit-food-auto');
    if(!host) return;
    const btn = document.createElement('button');
    btn.id = 'mfit-apply-chips';
    btn.textContent = 'Aplicar seleÃ§Ã£o aos cards / cardÃ¡pio';
    btn.style.cssText = 'margin-top:12px;padding:10px 14px;border-radius:10px;border:1px solid #1e1e1e;background:#00CC66;color:#000;font-weight:600;cursor:pointer';
    btn.addEventListener('click', syncToCards);
    host.appendChild(btn);
  }

  // Atualiza botÃ£o e sincroniza quando objetivo/metabolismo mudarem
  function wireUpdates(){
    ['objetivo','metabolismo','metabox','met1','met2','met3','met4','met5'].forEach(id=>{
      const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        el.addEventListener('change', ensureApplyButton, {passive:true});
        el.addEventListener('input', ensureApplyButton, {passive:true});
      }
    });
  }

  // Inicializa
  setTimeout(ensureApplyButton, 0);
  wireUpdates();

  // Exponibiliza sincronizaÃ§Ã£o manual via console, se quiser
  window.mfit_applyChipsToCards = syncToCards;
})();
</script>
<script>
(function(){
  function byId(id){ return document.getElementById(id); }
  function safeMeta(){
    try{
      if(typeof mfit_classificar_metabolismo === 'function'){
        const m = mfit_classificar_metabolismo();
        if(m && /^(Ecto|Meso|Endo)/i.test(m)) return m;
      }
    }catch(e){}
    return null;
  }
  function clearHighlights(){
    document.querySelectorAll('.food-card').forEach(c=>{
      c.classList.remove('recommended','dim');
    });
  }
  function setVisible(ok){
    const guide = byId('mfit-guide');
    const auto  = byId('mfit-food-auto');
    const note  = byId('mfit-locked-note');
    if(guide) guide.classList.toggle('hidden', !ok);
    if(auto)  auto.classList.toggle('hidden',  !ok);
    if(note)  note.classList.toggle('hidden',   ok);
    if(!ok) clearHighlights();
  }
  function onChange(){
    const m = safeMeta();
    setVisible(!!m);
    if(m && typeof window.mfit_updateAutoFoods === 'function'){
      window.mfit_updateAutoFoods();
    }
    if(m && typeof window.mfit_markFoodCards === 'function'){
      window.mfit_markFoodCards();
    }
  }
  // Esconde/mostra conforme estado no carregamento
  setVisible(false);
  const ids = ['met1','met2','met3','met4','met5','metabolismo'];
  ids.forEach(id=>{
    const el = byId(id) || document.querySelector(`[name="${id}"]`);
    if(el){
      el.addEventListener('change', onChange, {passive:true});
      el.addEventListener('input', onChange, {passive:true});
    }
  });
  let tries = 0;
  const iv = setInterval(()=>{
    tries++;
    onChange();
    if(tries>20) clearInterval(iv);
  }, 200);
})();
</script>
<script>
// === MFIT v1.8: CabeÃ§alho fixo; ordem interna = Objetivo â†’ Teste â†’ Guia â†’ Alimentos; autoaplica ===
(function(){
  function byId(id){ return document.getElementById(id); }
  function closestCard(el){
    if(!el) return null;
    let n = el;
    while(n && n !== document.body){
      if(n.classList && n.classList.contains('card')) return n;
      n = n.parentElement;
    }
    return el.parentElement || null;
  }
  function getTestContainer(){
    const ids = ['met1','met2','met3','met4','met5','metabolismo'];
    for(const id of ids){
      const el = byId(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        const card = closestCard(el);
        return card || el.closest('section, div, fieldset, form') || el.parentElement;
      }
    }
    return null;
  }
  function getObjetivoContainer(){
    const el = byId('objetivo') || document.querySelector('[name="objetivo"]') || null;
    if(!el) return null;
    const card = closestCard(el);
    return card || el.closest('section, div, fieldset, form') || el.parentElement;
  }
  function arrangeLocal(){
    const objetivoBox = getObjetivoContainer();
    const testBox = getTestContainer();
    const guide = byId('mfit-guide');
    const note = byId('mfit-locked-note');
    const auto = byId('mfit-food-auto');
    if(!objetivoBox) return;

    // NÃ£o mover objetivo para o topo do documento! MantÃ©m cabeÃ§alho intacto.
    // Apenas garante a sequÃªncia relativa dentro do mesmo pai.
    const parent = objetivoBox.parentElement;

    if(testBox && testBox !== objetivoBox){
      if(testBox.parentElement !== parent){
        // move para o mesmo container do objetivo
        parent.appendChild(testBox);
      }
      objetivoBox.insertAdjacentElement('afterend', testBox);
    }
    if(guide){
      const anchor = testBox || objetivoBox;
      if(guide.parentElement !== parent){
        parent.appendChild(guide);
      }
      anchor.insertAdjacentElement('afterend', guide);
      if(note){
        if(note.parentElement !== parent){
          parent.appendChild(note);
        }
        guide.insertAdjacentElement('afterend', note);
      }
    }
    if(auto){
      const anchor2 = guide || testBox || objetivoBox;
      if(auto.parentElement !== parent){
        parent.appendChild(auto);
      }
      anchor2.insertAdjacentElement('afterend', auto);
    }
  }

  function safeMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return null;
  }
  function hasObj(){
    const el = byId('objetivo') || document.querySelector('[name="objetivo"]');
    return !!(el && (el.value || el.textContent));
  }
  function autoApply(){
    const m = safeMeta();
    if(m && /^(Ecto|Meso|Endo)/i.test(m) && hasObj()){
      if(typeof window.mfit_updateAutoFoods === 'function') window.mfit_updateAutoFoods();
      if(typeof window.mfit_markFoodCards === 'function') window.mfit_markFoodCards();
      if(typeof window.mfit_applyChipsToCards === 'function') window.mfit_applyChipsToCards();
    }
  }

  function wire(){
    const ids = ['objetivo','met1','met2','met3','met4','met5','metabolismo'];
    ids.forEach(id=>{
      const el = byId(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        el.addEventListener('change', autoApply, {passive:true});
        el.addEventListener('input', autoApply, {passive:true});
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function(){
    arrangeLocal();
    wire();
    let tries = 0;
    const iv = setInterval(()=>{
      arrangeLocal();
      autoApply();
      tries++;
      if(tries>20) clearInterval(iv);
    }, 200);
  });
})();
</script>
<script>
// === MFIT v1.9: Levar o bloco de aÃ§Ãµes (WhatsApp/Copy) para o final ===
(function(){
  function moveActionsToBottom(){
    const root = document.querySelector('.container') || document.body;
    // Procura por botÃµes pelo texto
    const allBtns = Array.from(document.querySelectorAll('button, a'));
    const targets = allBtns.filter(b => /enviar respostas no whatsapp/i.test(b.textContent) ||
                                        /copiar mensagem/i.test(b.textContent) ||
                                        /whatsapp/i.test(b.textContent));
    if(targets.length === 0) return;
    // Encontra o contÃªiner mais externo relevante (card/section/div)
    function outerBox(el){
      return el.closest('.card, section, form, div') || el.parentElement;
    }
    const boxes = Array.from(new Set(targets.map(outerBox).filter(Boolean)));
    if(boxes.length === 0) return;
    // Agrupa em um wrapper e manda para o final, apÃ³s mfit-food-auto se existir
    let wrapper = document.getElementById('mfit-actions-final');
    if(!wrapper){
      wrapper = document.createElement('div');
      wrapper.id = 'mfit-actions-final';
      wrapper.style.margin = '24px 0';
    }else{
      wrapper.innerHTML = '';
    }
    boxes.forEach(box => wrapper.appendChild(box));
    const anchor = document.getElementById('mfit-food-auto') || document.getElementById('mfit-guide') || root.lastElementChild;
    if(anchor && anchor.parentElement){
      anchor.parentElement.insertBefore(wrapper, anchor.nextSibling);
    }else{
      root.appendChild(wrapper);
    }
  }
  document.addEventListener('DOMContentLoaded', moveActionsToBottom);
  // Reajusta apÃ³s mudanÃ§as que re-renderizam conteÃºdo
  setTimeout(moveActionsToBottom, 300);
  setTimeout(moveActionsToBottom, 1000);
  window.mfit_moveActionsToBottom = moveActionsToBottom;
})();
</script>
<script>
// === MFIT v2.0: regras expandidas + bloqueio do "nÃ£o indicado" ===
(function(){
  function norm(s){ return (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); }
  function byId(id){ return document.getElementById(id); }
  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
      return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){ return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal'; }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || 'Mesomorfo';
  }

  // VocabulÃ¡rio ampliado
  const K = {
    ovos:["ovo","ovos"],
    iogurte:["iogurte","leite desnatado","leite"],
    queijo_light:["queijo branco","ricota","cottage"],
    whey:["whey","proteina","proteÃ­na"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango","kiwi","melancia","melÃ£o","melao"],
    aveia:["aveia","farelo","granola sem aÃ§ucar","granola sem acucar","granola integral"],
    pao:["pao integral","pao","integral"],
    tapioca:["tapioca"],
    arroz:["arroz","arroz integral","integral"],
    macarrao:["macarrao","massa","espaguete","penne","parafuso","talharim","integral"],
    batata:["batata doce","mandioca","aipim","inhame","batata inglesa"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico","ervilha"],
    frango:["frango","peito de frango"],
    peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"],
    porco_mago:["lombo","lombo de porco","file mignon suÃ­no","file mignon suino","porco magro"],
    peru:["peito de peru","peru"],
    tofu:["tofu","soja"],
    salada:["salada","legume","alface","tomate","pepino","brocolis","brÃ³colis","cenoura","abobrinha","berinjela","couve","acelga","repolho"],
    wrap:["rap10","wrap","tortilha"],
    sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"],
    oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas","pasta de amendoim"],
    azeite:["azeite"],
    abacate:["abacate"],
    iogurte_grego:["iogurte grego"],
    arroz_parboilizado:["arroz parboilizado","parboilizado"]
  };

  // REGRAS (ampliadas): "yes" = indicado; "limit" = pode, mas com cautela; "no" = NÃƒO indicado (bloquear)
  const RULES = {
    "Emagrecimento / DefiniÃ§Ã£o corporal": {
      "Ectomorfo": { 
        yes:["ovos","frutas","aveia","arroz","macarrao","batata","frango","patinho","peixe","porco_mago","feijao","salada","wrap","pao","tapioca","tofu","queijo_light","iogurte"],
        limit:["oleaginosas","azeite","abacate","shake","whey","iogurte_grego"],
        no:["ultraprocessados","refrigerante","doce"] 
      },
      "Mesomorfo": { 
        yes:["ovos","aveia","frutas","iogurte","queijo_light","frango","peixe","patinho","porco_mago","arroz","feijao","salada","batata","tofu","wrap","pao","arroz_parboilizado"],
        limit:["macarrao","oleaginosas","azeite","abacate","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      },
      "Endomorfo": { 
        yes:["ovos","iogurte","queijo_light","frutas","frango","peixe","patinho","porco_mago","salada","batata","arroz_parboilizado","feijao","tofu"],
        limit:["arroz","pao","tapioca","macarrao","oleaginosas","azeite","abacate","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      }
    },
    "Ganho de massa muscular (hipertrofia)": {
      "Ectomorfo": { 
        yes:["pao","aveia","tapioca","arroz","macarrao","frutas","wrap","frango","patinho","porco_mago","peixe","feijao","salada","batata","whey","iogurte","queijo_light","peru","tofu","arroz_parboilizado"],
        limit:["oleaginosas","azeite","abacate","shake"],
        no:["ultraprocessados","refrigerante","doce"]
      },
      "Mesomorfo": { 
        yes:["aveia","frutas","arroz","feijao","macarrao","frango","patinho","porco_mago","peixe","salada","batata","wrap","iogurte","queijo_light","peru","tofu","arroz_parboilizado"],
        limit:["oleaginosas","azeite","abacate","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      },
      "Endomorfo": { 
        yes:["ovos","iogurte","queijo_light","frutas","arroz_parboilizado","feijao","batata","frango","patinho","porco_mago","peixe","salada","peru","tofu"],
        limit:["arroz","macarrao","tapioca","pao","oleaginosas","azeite","abacate","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      }
    },
    "SaÃºde / Emagrecimento": {
      "Ectomorfo": { 
        yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","porco_mago","salada","batata","iogurte","queijo_light","tofu","wrap","arroz_parboilizado"],
        limit:["oleaginosas","azeite","abacate","pao","tapioca","macarrao","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      },
      "Mesomorfo": { 
        yes:["arroz","feijao","aveia","frutas","frango","peixe","patinho","porco_mago","salada","batata","iogurte","queijo_light","tofu","wrap","arroz_parboilizado"],
        limit:["oleaginosas","azeite","abacate","pao","tapioca","macarrao","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      },
      "Endomorfo": { 
        yes:["ovos","iogurte","queijo_light","frutas","frango","peixe","patinho","porco_mago","salada","batata","feijao","arroz_parboilizado","tofu"],
        limit:["pao","macarrao","tapioca","arroz","oleaginosas","azeite","abacate","shake","whey"],
        no:["ultraprocessados","refrigerante","doce"]
      }
    }
  };

  // guarda em global para outras rotinas, se necessÃ¡rio
  window.__MFIT_RULES_V2 = RULES;

  // leitura de nome do card
  function getCardName(card){
    const dv = card.getAttribute('data-value');
    if(dv) return dv;
    const t = card.querySelector('.title, .name, .food-name');
    return (t ? t.textContent : card.textContent || '').trim();
  }

  function matchesAny(name, keys){
    const n = norm(name);
    return keys.some(k => n.includes(norm(k)));
  }

  function buildKeyWords(keys){
    return (keys||[]).flatMap(k => K[k] || []);
  }

  // Principal: marcar dim (limit) e blocked (no); NÃƒO selecionar nada.
  function applyFoodState(){
    const obj = getObj();
    const meta = getMeta();
    const pack = (RULES[obj] && RULES[obj][meta]) ? RULES[obj][meta] : null;
    const yesKeys = buildKeyWords(pack ? pack.yes : []);
    const limitKeys = buildKeyWords(pack ? pack.limit : []);
    const noKeys = buildKeyWords(pack ? pack.no : []);

    document.querySelectorAll('.food-card').forEach(card => {
      const name = getCardName(card);
      card.classList.remove('recommended','selected','dim','blocked');
      card.removeAttribute('aria-pressed');
      card.removeAttribute('aria-disabled');
      // ordem: no > limit > livre
      if(noKeys.length && matchesAny(name, noKeys)){
        card.classList.add('blocked'); // bloqueado
        card.setAttribute('aria-disabled','true');
      } else if(limitKeys.length && matchesAny(name, limitKeys)){
        card.classList.add('dim'); // pode, mas limitado
      } else {
        // permitido livre â†’ nada de classe
      }
    });
  }

  // Bloqueia cliques nos cards bloqueados (defesa extra)
  document.addEventListener('click', function(e){
    const card = e.target.closest('.food-card');
    if(card && card.classList.contains('blocked')){
      e.preventDefault(); e.stopPropagation();
      // feedback opcional acessÃ­vel
      card.setAttribute('title','NÃ£o indicado para seu objetivo/metabolismo');
      return false;
    }
  }, true);

  // Gatilhos
  ['objetivo','metabolismo','met1','met2','met3','met4','met5'].forEach(id=>{
    const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
    if(el){
      el.addEventListener('change', applyFoodState, {passive:true});
      el.addEventListener('input', applyFoodState, {passive:true});
    }
  });

  // Executa na carga
  setTimeout(applyFoodState, 0);

  // Exponibiliza para outras rotinas
  window.mfit_applyFoodState_v2 = applyFoodState;
})();
</script>
<script>
// === MFIT v2.1: desativa autoseleÃ§Ã£o e remove botÃ£o "Aplicar seleÃ§Ã£o" ===
(function(){
  function nukeAutoSelect(){
    // Remove botÃ£o se existir
    var btn = document.getElementById('mfit-apply-chips');
    if(btn && btn.parentElement){ btn.parentElement.removeChild(btn); }
    // No-ops para funÃ§Ãµes antigas
    window.mfit_applyChipsToCards = function(){};
    // Reaproveita nosso estado v2 (bloqueado/dim) quando alguÃ©m chamar markFoodCards
    if(typeof window.mfit_applyFoodState_v2 === 'function'){
      window.mfit_markFoodCards = window.mfit_applyFoodState_v2;
      // aplica imediatamente para garantir consistÃªncia
      window.mfit_applyFoodState_v2();
    }
  }
  document.addEventListener('DOMContentLoaded', nukeAutoSelect);
  // reforÃ§o em caso de re-render
  setTimeout(nukeAutoSelect, 200);
  setTimeout(nukeAutoSelect, 800);
})();
</script>
<script>
// === MFIT v2.4: Final consistente (Escolhidos / Permitidos / Bloqueados) ===
(function(){
  function byId(id){ return document.getElementById(id); }
  function norm(s){ return (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); }
  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
    return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){ return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal'; }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || 'Mesomorfo';
  }

  // Reaproveita regras v2.0 se existirem, senÃ£o cria um mÃ­nimo seguro
  const RULES = window.__MFIT_RULES_V2 || {
    "Emagrecimento / DefiniÃ§Ã£o corporal": {
      "Mesomorfo": { yes:["arroz","feijao","frango","peixe","patinho","salada","batata","aveia","frutas"], limit:["macarrao"], no:["ultraprocessados"] }
    }
  };

  // VocabulÃ¡rio (mesmo da v2.0)
  const K = {
    ovos:["ovo","ovos"], iogurte:["iogurte","leite desnatado","leite"],
    queijo_light:["queijo branco","ricota","cottage"], whey:["whey","proteina","proteÃ­na"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango","kiwi","melancia","melÃ£o","melao"],
    aveia:["aveia","farelo","granola sem aÃ§ucar","granola sem acucar","granola integral"],
    pao:["pao integral","pao","integral"], tapioca:["tapioca"],
    arroz:["arroz","arroz integral","integral","parboilizado","arroz parboilizado"],
    macarrao:["macarrao","massa","espaguete","penne","parafuso","talharim","integral"],
    batata:["batata doce","mandioca","aipim","inhame","batata inglesa"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico","ervilha"],
    frango:["frango","peito de frango"], peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"], porco_mago:["lombo","file mignon suino","suÃ­no","suino"],
    peru:["peito de peru","peru"], tofu:["tofu","soja"], salada:["salada","legume","alface","tomate","pepino","brocolis","brÃ³colis","cenoura","abobrinha","berinjela","couve","acelga","repolho"],
    wrap:["rap10","wrap","tortilha"], sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"], oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas","pasta de amendoim"],
    azeite:["azeite"], abacate:["abacate"], iogurte_grego:["iogurte grego"],
    arroz_parboilizado:["arroz parboilizado","parboilizado"]
  };

  // Conversores
  const LABELS = {
    ovos:"Ovos", iogurte:"Iogurte / Leite desnatado", queijo_light:"Queijo branco / Ricota / Cottage",
    whey:"Whey", frutas:"Frutas", aveia:"Aveia / Granola sem aÃ§Ãºcar", pao:"PÃ£o integral", tapioca:"Tapioca",
    arroz:"Arroz (integral/parboilizado)", macarrao:"MacarrÃ£o (pref. integral)", batata:"Batata doce / Mandioca / Inhame",
    feijao:"FeijÃ£o / Leguminosas", frango:"Frango", peixe:"Peixe", patinho:"Patinho / Carne magra",
    porco_mago:"Lombo / SuÃ­no magro", peru:"Peito de peru", tofu:"Tofu", salada:"Saladas / Legumes",
    wrap:"Rap10 / Wrap", sanduiche:"SanduÃ­che natural", shake:"Shake / Vitamina",
    oleaginosas:"Oleaginosas", azeite:"Azeite", abacate:"Abacate", iogurte_grego:"Iogurte grego",
    arroz_parboilizado:"Arroz parboilizado"
  };

  // util para checar se um nome de card bate em alguma KEY
  function nameHasKey(name, key){ const words = K[key] || []; return words.some(w => norm(name).includes(norm(w))); }
  function getCardName(card){
    const dv = card.getAttribute('data-value');
    if(dv) return dv;
    const t = card.querySelector('.title, .name, .food-name');
    return (t ? t.textContent : card.textContent || '').trim();
  }

  // Mapeia estado atual de cards -> set de keys selecionados
  function readSelectedFromCards(){
    const out = new Set();
    document.querySelectorAll('.food-card.selected').forEach(c => {
      const name = getCardName(c);
      for(const key in K){ if(nameHasKey(name, key)){ out.add(key); break; } }
    });
    return out;
  }

  // Render helpers
  function mkChip(label, key, disabled=false, checked=false){
    const id = 'chip_'+key+'_'+Math.random().toString(36).slice(2,7);
    const wrap = document.createElement('label');
    wrap.className = 'mfit-chip'+(disabled?' block':'');
    wrap.innerHTML = `<input type="checkbox" ${checked?'checked':''} ${disabled?'disabled':''} id="${id}" data-key="${key}" /> ${label}`;
    return wrap;
  }

  function renderPanels(){
    const obj = getObj();
    const meta = getMeta();
    const pack = (RULES[obj] && RULES[obj][meta]) ? RULES[obj][meta] : {yes:[], limit:[], no:[]};

    const selKeys = readSelectedFromCards(); // set()
    const allowed = pack.yes || [];
    const limited = pack.limit || [];
    const blocked = pack.no || [];

    // PainÃ©is DOM
    const chosen = byId('mfit-chosen');
    const allowedBox = byId('mfit-allowed');
    const blockedBox = byId('mfit-blocked');
    if(!chosen || !allowedBox || !blockedBox) return;

    chosen.innerHTML = '';
    allowedBox.innerHTML = '';
    blockedBox.innerHTML = '';

    // CHOSEN: mostrar selecionados que sejam allowed ou limited; ignorar bloqueados por seguranÃ§a
    const chosenKeys = Array.from(selKeys).filter(k => allowed.includes(k) || limited.includes(k));
    chosenKeys.forEach(k => chosen.appendChild(mkChip(LABELS[k]||k, k, false, true)));

    // ALLOWED: mostrar opÃ§Ãµes permitidas e limitadas NÃƒO selecionadas
    const poolAllowed = allowed.filter(k => !selKeys.has(k));
    const poolLimited = limited.filter(k => !selKeys.has(k));
    poolAllowed.forEach(k => allowedBox.appendChild(mkChip(LABELS[k]||k, k, false, false)));
    poolLimited.forEach(k => {
      const chip = mkChip((LABELS[k]||k)+' (limitar)', k, false, false);
      chip.style.opacity = .9;
      allowedBox.appendChild(chip);
    });

    // BLOCKED: chips desabilitados
    blocked.forEach(k => blockedBox.appendChild(mkChip(LABELS[k]||k, k, true, false)));

    // Listeners: marcar chips deve sincronizar com cards
    chosen.querySelectorAll('input[type="checkbox"]').forEach(input=>{
      input.addEventListener('change', e => {
        const key = e.target.getAttribute('data-key');
        if(!key) return;
        toggleCardsByKey(key, e.target.checked);
        // re-render apÃ³s troca
        setTimeout(renderPanels, 0);
      }, {passive:true});
    });
    allowedBox.querySelectorAll('input[type="checkbox"]').forEach(input=>{
      input.addEventListener('change', e => {
        const key = e.target.getAttribute('data-key');
        toggleCardsByKey(key, e.target.checked);
        setTimeout(renderPanels, 0);
      }, {passive:true});
    });
  }

  function toggleCardsByKey(key, shouldSelect){
    // NÃ£o altera cards bloqueados
    const words = K[key] || [];
    document.querySelectorAll('.food-card').forEach(c => {
      const name = getCardName(c);
      const match = words.some(w => norm(name).includes(norm(w)));
      if(!match) return;
      if(c.classList.contains('blocked')) return;
      if(shouldSelect){
        c.classList.add('selected');
        c.setAttribute('aria-pressed','true');
      }else{
        c.classList.remove('selected');
        c.setAttribute('aria-pressed','false');
      }
    });
    try{ if(typeof save === 'function') save(); }catch(e){}
    try{ if(typeof refreshPreview === 'function') refreshPreview(); }catch(e){}
    try{ if(typeof refreshDayPlan === 'function') refreshDayPlan(); }catch(e){}
  }

  // Quando cards mudarem (ex.: clique manual), reconstrÃ³i os painÃ©is
  document.addEventListener('click', function(e){
    const card = e.target.closest('.food-card');
    if(card && !card.classList.contains('blocked')){
      // pequeno atraso para o card aplicar .selected no handler nativo
      setTimeout(renderPanels, 50);
    }
  }, true);

  function wire(){
    ['objetivo','metabolismo','met1','met2','met3','met4','met5'].forEach(id=>{
      const el = byId(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        el.addEventListener('change', renderPanels, {passive:true});
        el.addEventListener('input', renderPanels, {passive:true});
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function(){
    wire();
    setTimeout(renderPanels, 0);
    setTimeout(renderPanels, 300);
  });

  // Exponibiliza para chamadas externas
  window.mfit_renderFinalPanels = renderPanels;
})();
</script>
<script>
(function(){
  // Sobrescreve apenas a funÃ§Ã£o renderPanels mantendo resto do v2.4
  const K = window.mfit_vocab_K || {
    ovos:["ovo","ovos"], iogurte:["iogurte","leite desnatado","leite"],
    queijo_light:["queijo branco","ricota","cottage"], whey:["whey","proteina","proteÃ­na"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango","kiwi","melancia","melÃ£o","melao"],
    aveia:["aveia","farelo","granola sem aÃ§ucar","granola sem acucar","granola integral"],
    pao:["pao integral","pao","integral"], tapioca:["tapioca"],
    arroz:["arroz","arroz integral","integral","parboilizado","arroz parboilizado"],
    macarrao:["macarrao","massa","espaguete","penne","parafuso","talharim","integral"],
    batata:["batata doce","mandioca","aipim","inhame","batata inglesa"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico","ervilha"],
    frango:["frango","peito de frango"], peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"], porco_mago:["lombo","file mignon suino","suÃ­no","suino"],
    peru:["peito de peru","peru"], tofu:["tofu","soja"], salada:["salada","legume","alface","tomate","pepino","brocolis","brÃ³colis","cenoura","abobrinha","berinjela","couve","acelga","repolho"],
    wrap:["rap10","wrap","tortilha"], sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"], oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas","pasta de amendoim"],
    azeite:["azeite"], abacate:["abacate"], iogurte_grego:["iogurte grego"],
    arroz_parboilizado:["arroz parboilizado","parboilizado"]
  };
  window.mfit_vocab_K = K;

  function norm(s){ return (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); }
  function byId(id){ return document.getElementById(id); }
  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
      return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){ return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal'; }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || 'Mesomorfo';
  }

  const RULES = window.__MFIT_RULES_V2 || {};

  const LABELS = window.mfit_labels || {
    ovos:"Ovos", iogurte:"Iogurte / Leite desnatado", queijo_light:"Queijo branco / Ricota / Cottage",
    whey:"Whey", frutas:"Frutas", aveia:"Aveia / Granola sem aÃ§Ãºcar", pao:"PÃ£o integral", tapioca:"Tapioca",
    arroz:"Arroz (integral/parboilizado)", macarrao:"MacarrÃ£o (pref. integral)", batata:"Batata doce / Mandioca / Inhame",
    feijao:"FeijÃ£o / Leguminosas", frango:"Frango", peixe:"Peixe", patinho:"Patinho / Carne magra",
    porco_mago:"Lombo / SuÃ­no magro", peru:"Peito de peru", tofu:"Tofu", salada:"Saladas / Legumes",
    wrap:"Rap10 / Wrap", sanduiche:"SanduÃ­che natural", shake:"Shake / Vitamina",
    oleaginosas:"Oleaginosas", azeite:"Azeite", abacate:"Abacate", iogurte_grego:"Iogurte grego",
    arroz_parboilizado:"Arroz parboilizado"
  };
  window.mfit_labels = LABELS;

  function getCardName(card){
    const dv = card.getAttribute('data-value');
    if(dv) return dv;
    const t = card.querySelector('.title, .name, .food-name');
    return (t ? t.textContent : card.textContent || '').trim();
  }
  function nameHasKey(name, key){
    const words = K[key] || []; return words.some(w => norm(name).includes(norm(w)));
  }

  function readSelectedFromCards(){
    const out = new Set();
    document.querySelectorAll('.food-card.selected').forEach(c => {
      const name = getCardName(c);
      for(const key in K){ if(nameHasKey(name, key)){ out.add(key); break; } }
    });
    return out;
  }

  function mkChip(label, key, disabled=false, checked=false){
    const id = 'chip_'+key+'_'+Math.random().toString(36).slice(2,7);
    const wrap = document.createElement('label');
    wrap.className = 'mfit-chip'+(disabled?' block':'');
    wrap.innerHTML = `<input type="checkbox" ${checked?'checked':''} ${disabled?'disabled':''} id="${id}" data-key="${key}" /> ${label}`;
    return wrap;
  }

  function toggleCardsByKey(key, shouldSelect){
    const words = K[key] || [];
    document.querySelectorAll('.food-card').forEach(c => {
      const name = getCardName(c);
      const match = words.some(w => norm(name).includes(norm(w)));
      if(!match) return;
      if(c.classList.contains('blocked')) return; // nunca mexe em bloqueado
      if(shouldSelect){ c.classList.add('selected'); c.setAttribute('aria-pressed','true'); }
      else { c.classList.remove('selected'); c.setAttribute('aria-pressed','false'); }
    });
    try{ if(typeof save === 'function') save(); }catch(e){}
    try{ if(typeof refreshPreview === 'function') refreshPreview(); }catch(e){}
    try{ if(typeof refreshDayPlan === 'function') refreshDayPlan(); }catch(e){}
  }

  window.mfit_renderFinalPanels = function renderPanels(){
    const obj = getObj();
    const meta = getMeta();
    const pack = (RULES[obj] && RULES[obj][meta]) ? RULES[obj][meta] : {yes:[], limit:[], no:[]};

    const chosen = byId('mfit-chosen');
    const allowedBox = byId('mfit-allowed');
    const blockedBox = byId('mfit-blocked');
    if(!chosen || !allowedBox || !blockedBox) return;

    const selKeys = readSelectedFromCards();

    // === PERMITIDOS: apenas YES ===
    const allowed = (pack.yes || []).filter(k => !selKeys.has(k));

    // === BLOQUEADOS: NO ===
    const blocked = (pack.no || []);

    // === CHOSEN ===
    const chosenKeys = Array.from(selKeys); // sÃ³ reflete seleÃ§Ã£o atual

    // limpa
    chosen.innerHTML = ''; allowedBox.innerHTML = ''; blockedBox.innerHTML='';

    // Render chosen
    chosenKeys.forEach(k => chosen.appendChild(mkChip(LABELS[k]||k, k, false, true)));

    // Render allowed YES
    allowed.forEach(k => {
      // se houver card correspondente e ele estiver bloqueado, nÃ£o mostre aqui
      let hasUnblockedCard = true;
      const words = K[k] || [];
      const cards = Array.from(document.querySelectorAll('.food-card'));
      if(cards.length){
        const matchCards = cards.filter(c => words.some(w => norm(getCardName(c)).includes(norm(w))));
        if(matchCards.length){
          hasUnblockedCard = matchCards.some(c => !c.classList.contains('blocked'));
        }
      }
      if(hasUnblockedCard){
        allowedBox.appendChild(mkChip(LABELS[k]||k, k, false, false));
      }
    });

    // Render blocked
    blocked.forEach(k => blockedBox.appendChild(mkChip(LABELS[k]||k, k, true, false)));

    // Eventos
    [chosen, allowedBox].forEach(box => {
      box.querySelectorAll('input[type="checkbox"]').forEach(input=>{
        input.addEventListener('change', e => {
          const key = e.target.getAttribute('data-key');
          toggleCardsByKey(key, e.target.checked);
          setTimeout(window.mfit_renderFinalPanels, 0);
        }, {passive:true});
      });
    });
  };

  // Re-render nos eventos padrÃµes
  function wire(){
    ['objetivo','metabolismo','met1','met2','met3','met4','met5'].forEach(id=>{
      const el = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        el.addEventListener('change', window.mfit_renderFinalPanels, {passive:true});
        el.addEventListener('input', window.mfit_renderFinalPanels, {passive:true});
      }
    });
    document.addEventListener('click', function(e){
      const card = e.target.closest('.food-card');
      if(card && !card.classList.contains('blocked')){
        setTimeout(window.mfit_renderFinalPanels, 60);
      }
    }, true);
  }
  document.addEventListener('DOMContentLoaded', function(){
    wire();
    setTimeout(window.mfit_renderFinalPanels, 0);
    setTimeout(window.mfit_renderFinalPanels, 300);
  });
})();
</script>
<script>
// === MFIT v2.6: Modelo de seleÃ§Ã£o persistente + sincronizaÃ§Ã£o e diagnÃ³stico ===
(function(){
  function byId(id){ return document.getElementById(id); }
  function norm(s){ return (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); }
  // Estado persistente para chips (sem depender de cards)
  if(!window.__MFIT_MANUAL_SELECTION){
    window.__MFIT_MANUAL_SELECTION = new Set();
  }
  const MAN = window.__MFIT_MANUAL_SELECTION;

  // VocabulÃ¡rio (reutiliza se existir)
  const K = window.mfit_vocab_K || {
    ovos:["ovo","ovos"], iogurte:["iogurte","leite desnatado","leite"],
    queijo_light:["queijo branco","ricota","cottage"], whey:["whey","proteina","proteÃ­na"],
    frutas:["fruta","banana","maca","maÃ§a","pera","laranja","manga","uva","abacaxi","morango","kiwi","melancia","melÃ£o","melao"],
    aveia:["aveia","farelo","granola sem aÃ§ucar","granola sem acucar","granola integral"],
    pao:["pao integral","pao","integral"], tapioca:["tapioca"],
    arroz:["arroz","arroz integral","integral","parboilizado","arroz parboilizado"],
    macarrao:["macarrao","massa","espaguete","penne","parafuso","talharim","integral"],
    batata:["batata doce","mandioca","aipim","inhame","batata inglesa"],
    feijao:["feijao","lentilha","grao de bico","grÃ£o de bico","ervilha"],
    frango:["frango","peito de frango"], peixe:["peixe","tilapia","atum","sardinha","salmao","salmÃ£o"],
    patinho:["patinho","carne magra","coxao mole","coxao duro"], porco_mago:["lombo","file mignon suino","suÃ­no","suino"],
    peru:["peito de peru","peru"], tofu:["tofu","soja"], salada:["salada","legume","alface","tomate","pepino","brocolis","brÃ³colis","cenoura","abobrinha","berinjela","couve","acelga","repolho"],
    wrap:["rap10","wrap","tortilha"], sanduiche:["sanduiche","sanduÃ­che","natural"],
    shake:["shake","vitamina","smoothie"], oleaginosas:["oleaginosa","amendoim","castanha","noz","amendoas","amÃªndoas","pasta de amendoim"],
    azeite:["azeite"], abacate:["abacate"], iogurte_grego:["iogurte grego"],
    arroz_parboilizado:["arroz parboilizado","parboilizado"]
  };
  window.mfit_vocab_K = K;

  const LABELS = window.mfit_labels || {
    ovos:"Ovos", iogurte:"Iogurte / Leite desnatado", queijo_light:"Queijo branco / Ricota / Cottage",
    whey:"Whey", frutas:"Frutas", aveia:"Aveia / Granola sem aÃ§Ãºcar", pao:"PÃ£o integral", tapioca:"Tapioca",
    arroz:"Arroz (integral/parboilizado)", macarrao:"MacarrÃ£o (pref. integral)", batata:"Batata doce / Mandioca / Inhame",
    feijao:"FeijÃ£o / Leguminosas", frango:"Frango", peixe:"Peixe", patinho:"Patinho / Carne magra",
    porco_mago:"Lombo / SuÃ­no magro", peru:"Peito de peru", tofu:"Tofu", salada:"Saladas / Legumes",
    wrap:"Rap10 / Wrap", sanduiche:"SanduÃ­che natural", shake:"Shake / Vitamina",
    oleaginosas:"Oleaginosas", azeite:"Azeite", abacate:"Abacate", iogurte_grego:"Iogurte grego",
    arroz_parboilizado:"Arroz parboilizado"
  };
  window.mfit_labels = LABELS;

  function valField(idOrName){
    const el = byId(idOrName);
    if(el) return el.value || el.textContent || '';
    const q = document.querySelector(`[name="${idOrName}"]:checked`) || document.querySelector(`[name="${idOrName}"]`);
    if(q){
      if(q.type==='radio'){
        const chk = document.querySelectorAll(`[name="${idOrName}"]:checked`);
        if(chk && chk[0]) return chk[0].value;
      }
      return q.value || q.textContent || '';
    }
    return '';
  }
  function getObj(){ return valField('objetivo') || 'Emagrecimento / DefiniÃ§Ã£o corporal'; }
  function getMeta(){
    try{ if(typeof mfit_classificar_metabolismo === 'function'){ return mfit_classificar_metabolismo(); } }catch(e){}
    return valField('metabolismo') || 'Mesomorfo';
  }

  const RULES = window.__MFIT_RULES_V2 || {};

  function getCardName(card){
    const dv = card.getAttribute('data-value');
    if(dv) return dv;
    const t = card.querySelector('.title, .name, .food-name');
    return (t ? t.textContent : card.textContent || '').trim();
  }
  function nameHasKey(name, key){
    const words = K[key] || []; return words.some(w => norm(name).includes(norm(w)));
  }

  // SeleÃ§Ã£o vinda dos cards
  function readSelectedFromCards(){
    const out = new Set();
    document.querySelectorAll('.food-card.selected').forEach(c => {
      const name = getCardName(c);
      for(const key in K){ if(nameHasKey(name, key)){ out.add(key); break; } }
    });
    return out;
  }

  // Util chips
  function mkChip(label, key, disabled=false, checked=false){
    const id = 'chip_'+key+'_'+Math.random().toString(36).slice(2,7);
    const wrap = document.createElement('label');
    wrap.className = 'mfit-chip'+(disabled?' block':'');
    wrap.innerHTML = `<input type="checkbox" ${checked?'checked':''} ${disabled?'disabled':''} id="${id}" data-key="${key}" /> ${label}`;
    return wrap;
  }

  function toggleCardsByKey(key, shouldSelect){
    const words = K[key] || [];
    let affected = 0;
    document.querySelectorAll('.food-card').forEach(c => {
      const name = getCardName(c);
      const match = words.some(w => norm(name).includes(norm(w)));
      if(!match) return;
      if(c.classList.contains('blocked')) return; // nÃ£o altera bloqueado
      affected++;
      if(shouldSelect){ c.classList.add('selected'); c.setAttribute('aria-pressed','true'); }
      else { c.classList.remove('selected'); c.setAttribute('aria-pressed','false'); }
    });
    // Atualiza modelo manual tambÃ©m
    if(shouldSelect) MAN.add(key); else MAN.delete(key);
    try{ if(typeof save === 'function') save(); }catch(e){}
    try{ if(typeof refreshPreview === 'function') refreshPreview(); }catch(e){}
    try{ if(typeof refreshDayPlan === 'function') refreshDayPlan(); }catch(e){}
    return affected;
  }

  // PainÃ©is finais
  function renderPanels(){
    const obj = getObj();
    const meta = getMeta();
    const pack = (RULES[obj] && RULES[obj][meta]) ? RULES[obj][meta] : {yes:[], limit:[], no:[]};
    const allowed = pack.yes || [];
    const blocked = pack.no || [];

    const chosen = byId('mfit-chosen');
    const allowedBox = byId('mfit-allowed');
    const blockedBox = byId('mfit-blocked');
    if(!chosen || !allowedBox || !blockedBox) return;

    // Conjunto final de seleÃ§Ã£o = cards selecionados âˆª MANUAL, menos bloqueados
    const selected = readSelectedFromCards();
    MAN.forEach(k => selected.add(k));
    blocked.forEach(k => selected.delete(k)); // garantia

    // limpa
    chosen.innerHTML = ''; allowedBox.innerHTML = ''; blockedBox.innerHTML='';

    // Chosen: dos selecionados que sÃ£o permitidos (ou limitados, se estiver usando limit fora)
    Array.from(selected).forEach(k => chosen.appendChild(mkChip(LABELS[k]||k, k, false, true)));

    // Allowed: apenas YES que nÃ£o estejam selecionados
    allowed.filter(k => !selected.has(k)).forEach(k => allowedBox.appendChild(mkChip(LABELS[k]||k, k, false, false)));

    // Blocked: NO desabilitados
    blocked.forEach(k => blockedBox.appendChild(mkChip(LABELS[k]||k, k, true, false)));

    // Eventos dos chips
    [chosen, allowedBox].forEach(box => {
      box.querySelectorAll('input[type="checkbox"]').forEach(input=>{
        input.addEventListener('change', e => {
          const key = e.target.getAttribute('data-key');
          const on = e.target.checked;
          // Atualiza cards se houver; se nÃ£o houver, persiste no modelo manual
          const hits = toggleCardsByKey(key, on);
          if(hits===0){
            if(on) MAN.add(key); else MAN.delete(key);
          }
          setTimeout(renderPanels, 0);
        }, {passive:true});
      });
    });
  }

  // Sincroniza o modelo manual quando o usuÃ¡rio clica num card
  document.addEventListener('click', function(e){
    const card = e.target.closest('.food-card');
    if(card && !card.classList.contains('blocked')){
      // detecta key do card
      const name = getCardName(card);
      let keyFound = null;
      for(const key in K){ if(nameHasKey(name, key)){ keyFound = key; break; } }
      if(keyFound){
        if(card.classList.contains('selected')) MAN.add(keyFound);
        else MAN.delete(keyFound);
      }
      setTimeout(renderPanels, 50);
    }
  }, true);

  function wire(){
    ['objetivo','metabolismo','met1','met2','met3','met4','met5'].forEach(id=>{
      const el = byId(id) || document.querySelector(`[name="${id}"]`);
      if(el){
        el.addEventListener('change', function(){
          // ao mudar perfil, limpamos seleÃ§Ã£o manual que ficou bloqueada no novo perfil
          const obj = getObj(); const meta = getMeta();
          const pack = (window.__MFIT_RULES_V2 && window.__MFIT_RULES_V2[obj] && window.__MFIT_RULES_V2[obj][meta]) ? window.__MFIT_RULES_V2[obj][meta] : {no:[]};
          const blocked = new Set(pack.no||[]);
          Array.from(MAN).forEach(k => { if(blocked.has(k)) MAN.delete(k); });
          renderPanels();
        }, {passive:true});
        el.addEventListener('input', renderPanels, {passive:true});
      }
    });
  }

  // FunÃ§Ã£o de diagnÃ³stico para console
  window.mfit_debugState = function(){
    const obj = getObj(); const meta = getMeta();
    const pack = (window.__MFIT_RULES_V2 && window.__MFIT_RULES_V2[obj] && window.__MFIT_RULES_V2[obj][meta]) ? window.__MFIT_RULES_V2[obj][meta] : {yes:[],limit:[],no:[]};
    const cards = Array.from(document.querySelectorAll('.food-card')).map(c=>({name:c.textContent.trim().slice(0,60), blocked:c.classList.contains('blocked'), selected:c.classList.contains('selected')}));
    return { objetivo: obj, metabolismo: meta, regras: pack, manual: Array.from(MAN), cards };
  };

  document.addEventListener('DOMContentLoaded', function(){
    wire();
    setTimeout(renderPanels, 0);
    setTimeout(renderPanels, 300);
  });
})();
</script>
<script>
(function(){
  function classificarDetalhado(){
    var pontos = {ecto:0, meso:0, endo:0};
    var responded = 0;
    for(var i=1;i<=7;i++){
      var nome = "m2_q"+i;
      var els = document.getElementsByName(nome);
      if(!els || !els.length) continue;
      var marcado = null;
      for(var j=0;j<els.length;j++){
        if(els[j].checked){ marcado = els[j].value; break; }
      }
      if(marcado){
        responded++;
        if(pontos.hasOwnProperty(marcado)){
          pontos[marcado] += 1;
        }
      }
    }
    if(responded < 3){
      return "";
    }
    var meta = "";
    if(pontos.ecto > pontos.meso && pontos.ecto > pontos.endo){
      meta = "Ectomorfo";
    } else if(pontos.endo > pontos.meso && pontos.endo > pontos.ecto){
      meta = "Endomorfo";
    } else if(pontos.meso > 0){
      meta = "Mesomorfo";
    }
    return meta;
  }

  window.mfit_calcular_metabolismo_detalhado = function(){
    var meta = classificarDetalhado();
    var spanDet = document.getElementById("metDetResultado");
    if(spanDet){
      spanDet.textContent = meta || "â€”";
    }
    var span = document.getElementById("metResultado");
    if(span && meta){
      span.textContent = meta;
    }
    if(typeof window.mfit_markFoodCards === "function"){
      window.mfit_markFoodCards();
    }
    if(typeof window.mfit_updateAutoFoods === "function"){
      window.mfit_updateAutoFoods();
    }
  };

  var oldSimple = window.mfit_classificar_metabolismo;
  window.mfit_classificar_metabolismo = function(){
    var meta = classificarDetalhado();
    if(meta){
      return meta;
    }
    if(typeof oldSimple === "function"){
      return oldSimple();
    }
    return "";
  };
})();
</script>
<script>
(function(){
  try{
    var cls = [];
    // Sempre dark mode MFIT
    cls.push('mfit-dark');
    // DetecÃ§Ã£o simples de "forÃ§a" do aparelho
    var cores = navigator.hardwareConcurrency || 2;
    var mem = navigator.deviceMemory || 2;
    if(cores >= 6 && mem >= 4){
      cls.push('mfit-pro');
    }else{
      cls.push('mfit-lite');
    }
    document.addEventListener('DOMContentLoaded', function(){
      document.body.classList.add.apply(document.body.classList, cls);
    });
  }catch(e){
    // fallback: lite
    document.addEventListener('DOMContentLoaded', function(){
      document.body.classList.add('mfit-dark','mfit-lite');
    });
  }
})();
</script>


<script>
/* MFIT â€” Biotipo: apenas exibir imagens jÃ¡ salvas (sem upload) */
(function(){
  const KEY_PREFIX = "mfit_bio_img_";
  function getSaved(meta){
    try{
      return localStorage.getItem(KEY_PREFIX + "M_" + meta) ||
             localStorage.getItem(KEY_PREFIX + "F_" + meta) || "";
    }catch(e){ return ""; }
  }
  document.addEventListener("DOMContentLoaded", ()=>{
    document.querySelectorAll("#secBiotipoVisual .bio-card").forEach(card=>{
      const meta = ((card.getAttribute("data-meta")||card.getAttribute("data-bio")||"").trim());
      const img = card.querySelector("img.bio-img");
      if(!meta || !img) return;
      const src = getSaved(meta);
      if(src){ img.src = src; }
    });
  });
})();
</script>


</body>
</html>
<script>
// ==== CORREÃ‡ÃƒO MFIT â€“ METABOLISMO + GUIA + ALIMENTOS (iPhone friendly) ====
(function () {
  function val(id) {
    var el = document.getElementById(id);
    return el ? (el.value || el.textContent || "").trim() : "";
  }

  // 1) ClassificaÃ§Ã£o simples e global
  window.mfit_classificar_metabolismo = function () {
    var v1 = val("met1");
    var v2 = val("met2");
    var v3 = val("met3");
    var v4 = val("met4");
    var v5 = val("met5");

    var ecto = 0, meso = 0, endo = 0;

    // Ganha peso
    if (v1 === "Com dificuldade") ecto++;
    if (v1 === "Com facilidade") endo++;

    // Biotipo visual
    if (v2 === "Mais magro") ecto++;
    if (v2 === "MÃ©dio")      meso++;
    if (v2 === "Mais largo") endo++;

    // Facilidade de perder peso
    if (v3 === "Sim") ecto++;
    if (v3 === "NÃ£o") endo++;

    // Apetite
    if (v4 === "Baixo") ecto++;
    if (v4 === "Alto")  endo++;

    // Energia
    if (v5 === "Alta o tempo todo")    ecto++;
    if (v5 === "Baixa com frequÃªncia") endo++;
    if (v5 === "Regular")             meso++;

    var res;
    if (ecto === 0 && meso === 0 && endo === 0) {
      res = "â€”";
    } else if (ecto > meso && ecto > endo) {
      res = "Ectomorfo";
    } else if (endo > meso && endo > ecto) {
      res = "Endomorfo";
    } else {
      res = "Mesomorfo";
    }

    var span = document.getElementById("metResultado");
    if (span) span.textContent = res;
    return res;
  };

  // 2) Mostrar / esconder guia e painel de alimentos
  function toggleMetaBlocks() {
    var meta = window.mfit_classificar_metabolismo();
    var ok = (meta === "Ectomorfo" || meta === "Mesomorfo" || meta === "Endomorfo");

    var guide = document.getElementById("mfit-guide");
    var auto  = document.getElementById("mfit-food-auto");
    var note  = document.getElementById("mfit-locked-note");

    if (guide) guide.classList.toggle("hidden", !ok);
    if (auto)  auto.classList.toggle("hidden", !ok);
    if (note)  note.classList.toggle("hidden", ok);

    // Se existirem, atualiza regras de alimentos e cards
    if (typeof window.mfit_updateAutoFoods === "function") {
      window.mfit_updateAutoFoods();
    }
    if (typeof window.mfit_markFoodCards === "function") {
      window.mfit_markFoodCards();
    }
  }

  // 3) Liga nos campos do teste + objetivo
  ["met1","met2","met3","met4","met5","objetivo"].forEach(function (id) {
    var el = document.getElementById(id);
    if (!el) return;
    el.addEventListener("change", toggleMetaBlocks);
    el.addEventListener("input",  toggleMetaBlocks);
  });

  // 4) Primeira checagem (iPhone/safari inclusive)
  document.addEventListener("DOMContentLoaded", function () {
    toggleMetaBlocks();
    // pequeno reforÃ§o nos primeiros segundos
    var tries = 0;
    var iv = setInterval(function () {
      toggleMetaBlocks();
      tries++;
      if (tries > 10) clearInterval(iv);
    }, 250);
  });
})();
</script>